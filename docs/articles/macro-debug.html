<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Debugging • macro</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js" integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Debugging">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">


    <div class="container template-article">
      <header><div class="navbar navbar-inverse navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">macro</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.1.2</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav"></ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="../articles/macro.html">Get started</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles

    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/macro-language.html">Macro Language</a>
    </li>
    <li>
      <a href="../articles/macro-debug.html">Debugging</a>
    </li>
    <li>
      <a href="../articles/macro-example1.html">Example 1: Listing</a>
    </li>
    <li>
      <a href="../articles/macro-example2.html">Example 2: Another Listing</a>
    </li>
    <li>
      <a href="../articles/macro-example3.html">Example 3: Table</a>
    </li>
    <li>
      <a href="../articles/macro-disclaimer.html">Disclaimer</a>
    </li>
    <li>
      <a href="../articles/macro-faq.html">Frequently Asked Questions</a>
    </li>
  </ul>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li>
  <a href=".././articles/macro-faq.html">FAQ</a>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
<li>
  <a href="https://github.com/dbosak01/macro/" class="external-link">
    <span class="fab fa-github fa-lg"></span>

  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->



      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Debugging</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/dbosak01/macro/blob/HEAD/vignettes/macro-debug.Rmd" class="external-link"><code>vignettes/macro-debug.Rmd</code></a></small>
      <div class="hidden name"><code>macro-debug.Rmd</code></div>

    </div>

    
    
<p>Macro-enabling a program can make it more complicated to debug.
Fortunately, there is a debug feature in the <strong>macro</strong>
package that can make debugging easier.</p>
<div class="section level2">
<h2 id="how-to-debug-a-macro">How to Debug a Macro<a class="anchor" aria-label="anchor" href="#how-to-debug-a-macro"></a>
</h2>
<p>To enhance debugging, the <code><a href="../reference/msource.html">msource()</a></code> function contains
two parameters: <code>debug</code> and <code>debug_out</code>.</p>
<p>The <code>debug</code> parameter turns debugging on or off. When set
to TRUE, the debug parameter will send debugging information to the
console. This information can be useful in helping debug the
program.</p>
<p>Here is a very simple macro program to illustrate the debug
feature:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#%let env &lt;- dev</span></span>
<span><span class="co">#%let dev_path &lt;- ./dev/data</span></span>
<span><span class="co">#%let prod_path &lt;- ./prod/data</span></span>
<span></span>
<span><span class="co"># Path to data</span></span>
<span><span class="co">#%if ("env." == "prod")</span></span>
<span><span class="va">pth</span> <span class="op">&lt;-</span> <span class="st">"prod_path./dm.sas7bdat"</span></span>
<span><span class="co">#%else</span></span>
<span><span class="va">pth</span> <span class="op">&lt;-</span> <span class="st">"dev_path./dm.sas7bdat"</span></span>
<span><span class="co">#%end</span></span></code></pre></div>
<p>The above macro program sets the path to a SAS dataset. The code
contains a macro condition to choose the “dev” or “prod” path. Then the
path is constructed via supplied macro variables.</p>
<p>The above code is placed into an R script, and run via
<code><a href="../reference/msource.html">msource()</a></code> on the command line. The generated output looks
like this:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="co"># Path to data</span></span>
<span><span class="va">pth</span> <span class="op">&lt;-</span> <span class="st">"./dev/data/dm.sas7bdat"</span></span></code></pre></div>
<div class="section level3">
<h3 id="debug-output">Debug Output<a class="anchor" aria-label="anchor" href="#debug-output"></a>
</h3>
<p>Now let’s turn debugging on to examine the debug information. To turn
debugging on, simply set the <code>debug</code> parameter to TRUE. Like
this:</p>
<pre><code>&gt; msource("./Debug1.R", "./Debug1_mod.R", debug = TRUE)</code></pre>
<p>Normally, the <code><a href="../reference/msource.html">msource()</a></code> function does not return
anything when executed. But when the <code>debug</code> parameter is
TRUE, the following is printed to the console:</p>
<pre><code>&gt; msource("./Debug1.R", "./Debug1_mod.R", debug = TRUE)
******************************************************************************** 
**  Pre-Processing
******************************************************************************** 
-    File In:  ./tests/testthat/examples/Debug1.R 
-   File Out:  ./tests/testthat/examples/Debug1_mod.R 
******************************************************************************** 
[ In#][Out#]:
[   1][    ]: #%let env &lt;- dev
[   2][    ]: #%let dev_path &lt;- ./dev/data
[   3][    ]: #%let prod_path &lt;- ./prod/data
[   4][   1]: 
[   5][   2]: # Path to data
[   6][    ]: #%if ("env." == "prod")
[   7][    ]: pth &lt;- "prod_path./dm.sas7bdat"
[   8][    ]: #%else
[   9][   3]: pth &lt;- "./dev/data/dm.sas7bdat"
[  10][    ]: #%end
[  11][   4]: 
******************************************************************************** 
**  Execution
******************************************************************************** 

&gt; # Path to data
&gt; pth &lt;- "./dev/data/dm.sas7bdat"

******************************************************************************** 
**  End
******************************************************************************** 
</code></pre>
<p>Note the following about the above debug information:</p>
<ul>
<li>The debug info starts with a header that introduces the
pre-processing stage. The header contains the path of the input and
output files.</li>
<li>The pre-processor then steps through the input file one line at a
time. The pre-processor outputs each input line, and determines whether
it should be emitted to the output file. The line numbers for the input
and output file are shown in the left margin of the debug output. If the
line is not emitted to the output file, the line number is shown as
blank.</li>
<li>All emitted lines are resolved as they will appear in the generated
code. Lines that are not emitted are not resolved.</li>
<li>After pre-processing, the generated code file will be executed. A
separation header announces the execution phase.</li>
<li>The generated code is sourced and echoed into the execution section
of the debug info.</li>
<li>The debug info is concluded with an ending separator, which signals
completion of processing.</li>
</ul>
</div>
<div class="section level3">
<h3 id="errors">Errors<a class="anchor" aria-label="anchor" href="#errors"></a>
</h3>
<p>Now let’s intentionally introduce some errors into this program, to
see how they are handled in the debugger.</p>
<div class="section level4">
<h4 id="error-in-macro-syntax">Error in Macro Syntax<a class="anchor" aria-label="anchor" href="#error-in-macro-syntax"></a>
</h4>
<p>First, we’ll introduce a syntax error into a macro statement. On line
6 of the macro program, we’ll delete one of the parenthesis. Like
this:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Path to data</span></span>
<span><span class="co">#%if ("env." == "prod"   </span></span></code></pre></div>
<p>Then we’ll run <code><a href="../reference/msource.html">msource()</a></code> again. The debug info will then
show the following:</p>
<pre><code>&gt; msource("./Debug1.R", "./Debug1_mod.R", debug = TRUE)
******************************************************************************** 
**  Pre-Processing
******************************************************************************** 
-    File In:  ./tests/testthat/examples/Debug1.R 
-   File Out:  ./tests/testthat/examples/Debug1_mod.R 
******************************************************************************** 
[ In#][Out#]:
[   1][    ]: #%let env &lt;- dev
[   2][    ]: #%let dev_path &lt;- ./dev/data
[   3][    ]: #%let prod_path &lt;- ./prod/data
[   4][   1]: 
[   5][   2]: # Path to data
Error in str2expression(trimws(nr)) : &lt;text&gt;:2:0: unexpected end of input
1: ("dev" == "prod"
   ^
</code></pre>
<p>Observe that the pre-processor stopped at the moment the syntax error
is encountered on line 6. The error encountered is displayed in the
debug info, and the error message indicates that there is an unmatched
parenthesis.</p>
</div>
<div class="section level4">
<h4 id="missing-end">Missing <code>#%end</code><a class="anchor" aria-label="anchor" href="#missing-end"></a>
</h4>
<p>The next error we will introduce is a missing <code>#%end</code> in
the macro condition. To introduce this error, remove the
<code>#%end</code> on line 10 from the original script. Then rerun
<code><a href="../reference/msource.html">msource()</a></code>. The debug info will display the following:</p>
<pre><code>&gt; msource("./Debug1.R", "./Debug1_mod.R", debug = TRUE)
******************************************************************************** 
**  Pre-Processing
******************************************************************************** 
-    File In:  ./tests/testthat/examples/Debug1.R 
-   File Out:  ./tests/testthat/examples/Debug1_mod.R 
******************************************************************************** 
[ In#][Out#]:
[   1][    ]: #%let env &lt;- dev
[   2][    ]: #%let dev_path &lt;- ./dev/data
[   3][    ]: #%let prod_path &lt;- ./prod/data
[   4][   1]: 
[   5][   2]: # Path to data
[   6][    ]: #%if ("env." == "prod")
[   7][    ]: pth &lt;- "prod_path./dm.sas7bdat"
[   8][    ]: #%else
[   9][   3]: pth &lt;- "./dev/data/dm.sas7bdat"
[  10][    ]: 
[  11][   4]: 
Error in mprocess(lns, debug) : 
  End of file reached with conditional block incomplete. Did you forget an '#%end'?
</code></pre>
</div>
<div class="section level4">
<h4 id="extra-end">Extra <code>#%end</code><a class="anchor" aria-label="anchor" href="#extra-end"></a>
</h4>
<p>In the next example, we’ll add an extra <code>#%end</code> instead of
removing it. Like this:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#%let env &lt;- dev</span></span>
<span><span class="co">#%let dev_path &lt;- ./dev/data</span></span>
<span><span class="co">#%let prod_path &lt;- ./prod/data</span></span>
<span></span>
<span><span class="co"># Path to data</span></span>
<span><span class="co">#%if ("env." == "prod")</span></span>
<span><span class="va">pth</span> <span class="op">&lt;-</span> <span class="st">"prod_path./dm.sas7bdat"</span></span>
<span><span class="co">#%else</span></span>
<span><span class="va">pth</span> <span class="op">&lt;-</span> <span class="st">"dev_path./dm.sas7bdat"</span></span>
<span><span class="co">#%end</span></span>
<span><span class="co">#%end</span></span></code></pre></div>
<p>Here is the result:</p>
<pre><code>&gt; msource("./Debug1.R", "./Debug1_mod.R", debug = TRUE)
******************************************************************************** 
**  Pre-Processing
******************************************************************************** 
-    File In:  ./tests/testthat/examples/Debug1.R 
-   File Out:  ./tests/testthat/examples/Debug1_mod.R 
******************************************************************************** 
[ In#][Out#]:
[   1][    ]: #%let env &lt;- dev
[   2][    ]: #%let dev_path &lt;- ./dev/data
[   3][    ]: #%let prod_path &lt;- ./prod/data
[   4][   1]: 
[   5][   2]: # Path to data
[   6][    ]: #%if ("env." == "prod")
[   7][    ]: pth &lt;- "prod_path./dm.sas7bdat"
[   8][    ]: #%else
[   9][   3]: pth &lt;- "./dev/data/dm.sas7bdat"
[  10][    ]: #%end
Error in mprocess(lns, debug) : Unexpected '#%end' on line 11.
</code></pre>
<p>The debug info shows us that it encountered an unexpected macro
command, and identifies the line number. This information is very useful
when debugging your macro code.</p>
</div>
<div class="section level4">
<h4 id="error-in-generated-code">Error in Generated Code<a class="anchor" aria-label="anchor" href="#error-in-generated-code"></a>
</h4>
<p>What happens when there is an error in the generated code? Let’s
introduce another error and find out.</p>
<p>For this example, we will put an extra space in the assignment arrow
on line 9. Like this:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#%let env &lt;- dev</span></span>
<span><span class="co">#%let dev_path &lt;- ./dev/data</span></span>
<span><span class="co">#%let prod_path &lt;- ./prod/data</span></span>
<span></span>
<span><span class="co"># Path to data</span></span>
<span><span class="co">#%if ("env." == "prod")</span></span>
<span><span class="va">pth</span> <span class="op">&lt;-</span> <span class="st">"prod_path./dm.sas7bdat"</span></span>
<span><span class="co">#%else</span></span>
<span><span class="va">pth</span> <span class="op">&lt;</span> <span class="op">-</span> <span class="st">"dev_path./dm.sas7bdat"</span></span>
<span><span class="co">#%end</span></span></code></pre></div>
<p>The above extra space should introduce a syntax error in the
generated code. Here is what it does:</p>
<pre><code>&gt; msource("./Debug1.R", "./Debug1_mod.R", debug = TRUE)
******************************************************************************** 
**  Pre-Processing
******************************************************************************** 
-    File In:  ./tests/testthat/examples/Debug1.R 
-   File Out:  ./tests/testthat/examples/Debug1_mod.R 
******************************************************************************** 
[ In#][Out#]:
[   1][    ]: #%let env &lt;- dev
[   2][    ]: #%let dev_path &lt;- ./dev/data
[   3][    ]: #%let prod_path &lt;- ./prod/data
[   4][   1]: 
[   5][   2]: # Path to data
[   6][    ]: #%if ("env." == "prod")
[   7][    ]: pth &lt;- "prod_path./dm.sas7bdat"
[   8][    ]: #%else
[   9][   3]: pth &lt; - "./dev/data/dm.sas7bdat"
[  10][    ]: #%end
******************************************************************************** 
**  Execution
******************************************************************************** 

&gt; # Path to data
&gt; pth &lt; - "./dev/data/dm.sas7bdat"
Error in -"./dev/data/dm.sas7bdat" : invalid argument to unary operator
</code></pre>
<p>Notice that the pre-processing stage completed as normal, and the
execution stage began. However, at the moment the syntax error was
encountered in the generated code, an error message was produced. This
printout should give you a clear indication of which line has a problem
and how to fix it.</p>
</div>
</div>
<div class="section level3">
<h3 id="debug-to-file">Debug to File<a class="anchor" aria-label="anchor" href="#debug-to-file"></a>
</h3>
<p>If desired, the debug information can be sent to a file instead of
the console. This capability is especially valuable for large programs,
where the number of lines may exceed the capacity of the console to
display the full debug information.</p>
<p>To send the debug information to a file, simply assign a path to the
<code>debug_out</code> parameter on <code><a href="../reference/msource.html">msource()</a></code>:</p>
<pre><code>&gt; msource("./Debug1.R", "./Debug1_mod.R", debug = TRUE, debug_out = "./log/Debug1.txt")
</code></pre>
<p>The debug information will now be redirected to the debug file
instead of the console. Here is the contents of the debug file:</p>
<pre><code>******************************************************************************** 
**  Pre-Processing
******************************************************************************** 
-    File In:  ./tests/testthat/examples/Debug1.R 
-   File Out:  ./tests/testthat/examples/Debug1_mod.R 
******************************************************************************** 
[ In#][Out#]:
[   1][    ]: #%let env &lt;- dev
[   2][    ]: #%let dev_path &lt;- ./dev/data
[   3][    ]: #%let prod_path &lt;- ./prod/data
[   4][   1]: 
[   5][   2]: # Path to data
[   6][    ]: #%if ("env." == "prod")
[   7][    ]: pth &lt;- "prod_path./dm.sas7bdat"
[   8][    ]: #%else
[   9][   3]: pth &lt;- "./dev/data/dm.sas7bdat"
[  10][    ]: #%end
******************************************************************************** 
**  Execution
******************************************************************************** 

&gt; # Path to data
&gt; pth &lt;- "./dev/data/dm.sas7bdat"

******************************************************************************** 
**  End
******************************************************************************** 
</code></pre>
<p>Observe that the information contained in the file is exactly the
same information shown on the console in the examples above.</p>
<p>Saving the debug information to a file has some benefits:</p>
<ul>
<li>Retains the full debug information output.</li>
<li>Provides a searchable log.<br>
</li>
<li>Preserves a record of a clean run.</li>
</ul>
<p>Therefore, the debug output file can be advantageous in some
scenarios.</p>
<p>Next: <a href="macro-example1.html">Example 1: Listing</a></p>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

      </div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by David Bosak.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.0.</p>
</div>

      </footer>
</div>






  </body>
</html>

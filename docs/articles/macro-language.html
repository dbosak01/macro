<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Macro Language • macro</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js" integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Macro Language">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">


    <div class="container template-article">
      <header><div class="navbar navbar-inverse navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">macro</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.1.2</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav"></ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="../articles/macro.html">Get started</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles

    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/macro-language.html">Macro Language</a>
    </li>
    <li>
      <a href="../articles/macro-debug.html">Debugging</a>
    </li>
    <li>
      <a href="../articles/macro-example1.html">Example 1: Listing</a>
    </li>
    <li>
      <a href="../articles/macro-example2.html">Example 2: Another Listing</a>
    </li>
    <li>
      <a href="../articles/macro-example3.html">Example 3: Table</a>
    </li>
    <li>
      <a href="../articles/macro-generated.html">Generalized vs. Generated</a>
    </li>
    <li>
      <a href="../articles/macro-disclaimer.html">Disclaimer</a>
    </li>
    <li>
      <a href="../articles/macro-faq.html">Frequently Asked Questions</a>
    </li>
  </ul>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li>
  <a href=".././articles/macro-faq.html">FAQ</a>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
<li>
  <a href="https://github.com/dbosak01/macro/" class="external-link">
    <span class="fab fa-github fa-lg"></span>

  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->



      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Macro Language</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/dbosak01/macro/blob/HEAD/vignettes/macro-language.Rmd" class="external-link"><code>vignettes/macro-language.Rmd</code></a></small>
      <div class="hidden name"><code>macro-language.Rmd</code></div>

    </div>

    
    
<p>Below is a glossary for all macro commands in the
<strong>macro</strong> package. The glossary contains the syntax, a
detailed explanation, and examples for each of the available
commands.</p>
<div class="section level2">
<h2 id="macro-comments">Macro Comments<a class="anchor" aria-label="anchor" href="#macro-comments"></a>
</h2>
<div class="section level3">
<h3 id="syntax">Syntax<a class="anchor" aria-label="anchor" href="#syntax"></a>
</h3>
<pre><code><span><span class="co">#% &lt;comment&gt;</span></span></code></pre>
<p>Where “&lt;comment&gt;” is any text string. The macro comment is a
single line comment. If you need multiple lines, use multiple macro
comments.</p>
</div>
<div class="section level3">
<h3 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a>
</h3>
<p>A macro comment is like a regular R comment, but with a “#%” prefix.
The macro comment can be used to document your macro statements. The
macro comment will be removed during pre-processing.</p>
</div>
<div class="section level3">
<h3 id="examples">Examples<a class="anchor" aria-label="anchor" href="#examples"></a>
</h3>
<p>Here is a macro comment and a regular R comment:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="co">#% Here is a macro comment</span></span>
<span></span>
<span><span class="co"># Here is a regular comment</span></span></code></pre></div>
<p>During pre-processing, the macro comment and the blank line before it
are removed:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="co"># Here is a regular comment</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="macro-variables">Macro Variables<a class="anchor" aria-label="anchor" href="#macro-variables"></a>
</h2>
<div class="section level3">
<h3 id="syntax-1">Syntax<a class="anchor" aria-label="anchor" href="#syntax-1"></a>
</h3>
<pre><code><span><span class="co">#%let &lt;variable&gt; &lt;- &lt;value&gt;</span></span>
<span><span class="co">#%let &lt;variable&gt; = &lt;value&gt;</span></span>
<span><span class="co">#%let &lt;variable&gt;</span></span></code></pre>
<p>Where “&lt;variable&gt;” is the name of the variable, and
“&lt;value&gt;” is some value assigned to the variable.</p>
<p>Note that macro variable names must begin with an alphabetic
character. They can contain only alphabetic characters, numbers, and an
underscore (“_“).</p>
<p>Macro variables should be named without a trailing dot (“.”). The
trailing dot will be appended automatically when the variable is added
to the symbol table.</p>
<p>Either the left arrow (“&lt;-”) or equals sign (“=”) is a valid
assignment operator for macro variables.</p>
<p>To clear a macro variable, leave it unassigned. This action will
remove the macro variable from the symbol table.</p>
</div>
<div class="section level3">
<h3 id="details-1">Details<a class="anchor" aria-label="anchor" href="#details-1"></a>
</h3>
<p>Macro variables are variables that have a temporary existence during
pre-processing. The variables are stored in the pre-processor symbol
table, and used as text replacement tokens during pre-processing.</p>
<p>The assigned value is treated as a string, and replaced exactly as
assigned. That means if the value is assigned without quotes, it will be
replaced without quotes. If the value is quoted, the quotes will be
retained during replacement.</p>
</div>
<div class="section level3">
<h3 id="examples-1">Examples<a class="anchor" aria-label="anchor" href="#examples-1"></a>
</h3>
<div class="section level4">
<h4 id="basic-assignment">Basic Assignment<a class="anchor" aria-label="anchor" href="#basic-assignment"></a>
</h4>
<p>Here is a basic macro assignment of numeric values:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#% Assignment using left arrow</span></span>
<span><span class="co">#%let a &lt;- 1</span></span>
<span><span class="va">x</span> <span class="op">&lt;-</span> <span class="va">a.</span></span>
<span></span>
<span><span class="co">#% Assignment using equals sign</span></span>
<span><span class="co">#%let b = 2</span></span>
<span><span class="va">y</span> <span class="op">&lt;-</span> <span class="va">b.</span></span></code></pre></div>
<p>Here is the resolved output:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fl">1</span></span>
<span><span class="va">y</span> <span class="op">&lt;-</span> <span class="fl">2</span></span></code></pre></div>
<p>Both variables <code>a.</code> an <code>b.</code> have been replaced
as assigned.</p>
</div>
<div class="section level4">
<h4 id="quoted-assignment">Quoted Assignment<a class="anchor" aria-label="anchor" href="#quoted-assignment"></a>
</h4>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#% Quoted Assignment</span></span>
<span><span class="co">#%let a &lt;- "One"</span></span>
<span><span class="va">x</span> <span class="op">&lt;-</span> <span class="va">a.</span></span>
<span></span>
<span><span class="co">#% Unquoted Assignment</span></span>
<span><span class="co">#%let b &lt;- Two</span></span>
<span><span class="va">y</span> <span class="op">&lt;-</span> <span class="st">"b."</span></span>
<span><span class="va">z</span> <span class="op">&lt;-</span> <span class="st">'b.'</span></span></code></pre></div>
<p>The above code will resolve as follows:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x</span> <span class="op">&lt;-</span> <span class="st">"One"</span></span>
<span><span class="va">y</span> <span class="op">&lt;-</span> <span class="st">"Two"</span></span>
<span><span class="va">z</span> <span class="op">&lt;-</span> <span class="st">'Two'</span></span></code></pre></div>
<p>Observe that single or double quotes have no effect on macro variable
resolution. Both are resolved normally. This behavior is different from
SAS.</p>
<p>If you do not quote the macro variable value, and do not quote the
macro variable to be replaced, it will result in an error:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#% Unquoted Assignment</span></span>
<span><span class="co">#%let c &lt;- Three</span></span>
<span></span>
<span><span class="co"># Unquoted resolution</span></span>
<span><span class="va">z</span> <span class="op">&lt;-</span> <span class="va">c.</span></span></code></pre></div>
<p>The error is:</p>
<pre><code>Error in eval(ei, envir) : object 'Three' not found</code></pre>
<p>The error occurs because the value “Three” is now left unquoted in
open code. The R parser thinks it is the name of a variable or object,
and will try to look it up in the environment. If it can’t find the name
in the environment, the parser generates an error.</p>
</div>
<div class="section level4">
<h4 id="variable-removal">Variable Removal<a class="anchor" aria-label="anchor" href="#variable-removal"></a>
</h4>
<p>If you want to remove an existing macro variable from the symbol
table, leave it unassigned. Like this:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#% Macro assignment</span></span>
<span><span class="co">#%let b &lt;- 2</span></span>
<span><span class="va">x</span> <span class="op">&lt;-</span> <span class="va">b.</span></span>
<span></span>
<span><span class="co">#% Clear assignment</span></span>
<span><span class="co">#%let b</span></span>
<span><span class="va">y</span> <span class="op">&lt;-</span> <span class="va">b.</span></span></code></pre></div>
<p>The above code will generate an error, as the <code>y &lt;- b.</code>
runs after the variable has been cleared. Here is the error that is
generated:</p>
<pre><code>Error in mreplace(ln) : 
  Macro variable 'b.' not valid for text replacement.</code></pre>
</div>
<div class="section level4">
<h4 id="global-macro-assignment">Global Macro Assignment<a class="anchor" aria-label="anchor" href="#global-macro-assignment"></a>
</h4>
<p>Macro variables can also be assigned in regular R code, as long as it
is done before <code><a href="../reference/msource.html">msource()</a></code> is executed. In the below code,
macro variable <code>c.</code> is assigned the value of 3, and then the
template code file “temp1.R” is executed via <code><a href="../reference/msource.html">msource()</a></code>:</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Assignment before msource()</span></span>
<span><span class="va">c.</span> <span class="op">&lt;-</span> <span class="fl">3</span></span>
<span></span>
<span><span class="co"># Pre-process</span></span>
<span><span class="fu"><a href="../reference/msource.html">msource</a></span><span class="op">(</span><span class="st">"./temp1.R"</span>, <span class="st">"./temp1_mod.R"</span><span class="op">)</span></span></code></pre></div>
<p>Here is the file “temp1.R”:</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Print macro variable</span></span>
<span><span class="va">z</span> <span class="op">&lt;-</span> <span class="va">c.</span></span></code></pre></div>
<p>When the “temp1.R” file is resolved to “temp1_mod.R”, it will look
like this:</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Print macro variable</span></span>
<span><span class="va">z</span> <span class="op">&lt;-</span> <span class="fl">3</span></span></code></pre></div>
<p>You can see that the macro variable <code>c.</code> is replaced
normally. The reason is because any variable with a trailing dot (“.”)
in the parent environment will be copied to the macro symbol table when
the pre-processor begins.</p>
<p>Also note that parent macro assignments do not need to take place in
the same code file as <code><a href="../reference/msource.html">msource()</a></code>. You can assign them in a
setup file if desired. As long as they exist in the parent environment,
the macro variables will be copied to the symbol table.</p>
</div>
<div class="section level4">
<h4 id="nested-assignment">Nested Assignment<a class="anchor" aria-label="anchor" href="#nested-assignment"></a>
</h4>
<p>Macro variables can be nested inside one another. Nesting means that
a macro variable name can be constructed from other macro
variables.<br>
This feature allows for more dynamic assignments. Here is a simple
demonstration:</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#%let x &lt;- 1;</span></span>
<span><span class="co">#%let mvar1 &lt;- Hello!</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="st">"mvarx.."</span><span class="op">)</span></span></code></pre></div>
<p>The above code outputs the string “Hello!”. Why? The reason is
because the macro processor first found the variable “x.” and replaced
it with the value “1”. The macro processor continued to scan for
variables, found that “mvar1.” was also a macro variable, and made the
replacement. The system allows up to 10 levels of nesting. This feature
can be useful in some situations.</p>
</div>
<div class="section level4">
<h4 id="advanced-assignment">Advanced Assignment<a class="anchor" aria-label="anchor" href="#advanced-assignment"></a>
</h4>
<p>The examples above use R macro variables much like regular variables.
However, it is important to realize that macro variables can be used
anywhere, to manipulate any piece of code. Here is a taste of some
advanced assignments:</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#%let a &lt;- # Subset mtcars</span></span>
<span><span class="co">#%let b &lt;- mtcars</span></span>
<span><span class="co">#%let c &lt;- , mpg &gt; 25</span></span>
<span><span class="co">#%let d &lt;- dat &lt;- subset(b.c.)</span></span>
<span><span class="co">#%let e &lt;- (dat)</span></span>
<span><span class="va">a.</span></span>
<span><span class="va">d.</span></span>
<span><span class="va">printe.</span></span></code></pre></div>
<p>Here is the generated code:</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Subset mtcars</span></span>
<span><span class="va">dat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="va">mtcars</span>, <span class="va">mpg</span> <span class="op">&gt;</span> <span class="fl">25</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">dat</span><span class="op">)</span></span></code></pre></div>
<p>And here is the console output:</p>
<pre><code>&gt;msource()
                mpg cyl  disp  hp drat    wt  qsec vs am gear carb
Fiat 128       32.4   4  78.7  66 4.08 2.200 19.47  1  1    4    1
Honda Civic    30.4   4  75.7  52 4.93 1.615 18.52  1  1    4    2
Toyota Corolla 33.9   4  71.1  65 4.22 1.835 19.90  1  1    4    1
Fiat X1-9      27.3   4  79.0  66 4.08 1.935 18.90  1  1    4    1
Porsche 914-2  26.0   4 120.3  91 4.43 2.140 16.70  0  1    5    2
Lotus Europa   30.4   4  95.1 113 3.77 1.513 16.90  1  1    5    2
</code></pre>
<p>Obviously, the above demonstration makes no sense. The point is to
illustrate that the R macro language views all code as text. You can
construct comments, lines of code, variable names, function calls,
parameters, or anything else using the macro language.</p>
</div>
</div>
</div>
<div class="section level2">
<h2 id="macro-conditionals">Macro Conditionals<a class="anchor" aria-label="anchor" href="#macro-conditionals"></a>
</h2>
<div class="section level3">
<h3 id="syntax-2">Syntax<a class="anchor" aria-label="anchor" href="#syntax-2"></a>
</h3>
<pre><code><span><span class="co">#%if &lt;condition&gt;</span></span>
<span><span class="co">#%if (&lt;condition&gt;)</span></span>
<span></span>
<span><span class="co">#%ifelse &lt;condition&gt;</span></span>
<span><span class="co">#%ifelse (&lt;condition&gt;)</span></span>
<span></span>
<span><span class="co">#%else</span></span>
<span></span>
<span><span class="co">#%end</span></span></code></pre>
<p>Where “&lt;condition&gt;” is an expression that evaluates to TRUE or
FALSE.</p>
<p>A macro conditional block must begin with an <code>#%if</code>
condition and be finalized with a <code>#%end</code>. The
<code>#%ifelse</code> and <code>#%else</code> blocks are optional.
Failure to finalize the block with an <code>#%end</code> will result in
an error or other unexpected behavior.</p>
<p>Parenthesis around the conditional expressions are optional but
recommended.</p>
<p>The syntax of R conditionals is somewhat different from SAS. One
difference is that the <code>%then %do</code> directives in SAS has been
entirely eliminated from the <strong>macro</strong> package syntax.
Another difference is that the <code>#%ifelse</code> command is one word
instead of two.<br>
A third difference is that in SAS, each conditional section must be
concluded with an <code>%end</code>. In R, you only need one
<code>#%end</code> at the conclusion of the entire conditional. In
general, the R syntax is simpler.</p>
</div>
<div class="section level3">
<h3 id="details-2">Details<a class="anchor" aria-label="anchor" href="#details-2"></a>
</h3>
<p>Conditional expressions should be standard R expressions, using
standard R syntax. For comparisons, the expression should use the
double-equals (“==”) comparison operator, as in a normal R “if”
statement. Likewise, all other comparison operators should follow Base R
syntax.</p>
<p>A conditional expression may contain macro variables. These macro
variables will be resolved before the expression is evaluated. Reminder
that the macro variables are text replacements, and will be resolved
accordingly.</p>
<p>The conditional expression may also contain R functions like
<code><a href="https://rdrr.io/r/base/any.html" class="external-link">any()</a></code> and <code><a href="https://rdrr.io/r/base/all.html" class="external-link">all()</a></code>. In most cases, these function
do not need to be wrapped in <code>%sysfunc()</code>. They will evaluate
properly as part of the expression.</p>
<p>If an expression in a macro “if” block is TRUE, the code inside that
block will be emitted during pre-processing. If the expression evaluates
to FALSE, code inside that block will be ignored.</p>
<p>Macro conditions may be nested inside one another. There is no limit
on the number of nested levels.</p>
</div>
<div class="section level3">
<h3 id="examples-2">Examples<a class="anchor" aria-label="anchor" href="#examples-2"></a>
</h3>
<div class="section level4">
<h4 id="simple-conditional">Simple Conditional<a class="anchor" aria-label="anchor" href="#simple-conditional"></a>
</h4>
<p>Here is a simple condition to construct a path. The source directory
can change depending on the environment.</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#%let dev_path &lt;- ./dev/data</span></span>
<span><span class="co">#%let prod_path &lt;- ./prod/data</span></span>
<span><span class="co">#%let env &lt;- dev</span></span>
<span></span>
<span><span class="co"># Path to data</span></span>
<span><span class="co">#%if ("env." == "prod")</span></span>
<span><span class="va">pth</span> <span class="op">&lt;-</span> <span class="st">"prod_path./dm.sas7bdat"</span></span>
<span><span class="co">#%else </span></span>
<span><span class="va">pth</span> <span class="op">&lt;-</span> <span class="st">"dev_path./dm.sas7bdat"</span></span>
<span><span class="co">#%end</span></span></code></pre></div>
<p>When run through the macro processor, the above code will generate
the following:</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="co"># Path to data</span></span>
<span><span class="va">pth</span> <span class="op">&lt;-</span> <span class="st">"./dev/data/dm.sas7bdat"</span></span></code></pre></div>
<p>The pre-processor selected the “dev” path as indicated, constructed
the path appropriately, and removed all macro statements.</p>
</div>
<div class="section level4">
<h4 id="nested-conditionals">Nested Conditionals<a class="anchor" aria-label="anchor" href="#nested-conditionals"></a>
</h4>
<p>Macro conditionals may also be nested inside one another. Nesting
allows you to construct more complicated logic. Here is an example:</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#% Data source SAS or RDS</span></span>
<span><span class="co">#%let src &lt;- SAS</span></span>
<span></span>
<span><span class="co">#% Select analysis variables</span></span>
<span><span class="co">#%let anal_vars &lt;- c("AGE", "AGEG", "SEX", "RACE", "PULSE", "TEMP")</span></span>
<span></span>
<span><span class="co">###################</span></span>
<span><span class="co"># Get data</span></span>
<span><span class="co">###################</span></span>
<span><span class="co">#%if ("src." == "SAS")</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://haven.tidyverse.org" class="external-link">haven</a></span><span class="op">)</span></span>
<span></span>
<span>  <span class="co"># Get adsl dataset</span></span>
<span>  <span class="va">adsl</span> <span class="op">&lt;-</span> <span class="fu">haven</span><span class="op">(</span><span class="st">"./data/ADSL.sas7bdat"</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co">#%if (any(c("PULSE", "TEMP", "BP") %in% anal_vars.))</span></span>
<span>  <span class="co"># Get advs dataset</span></span>
<span>  <span class="va">advs</span> <span class="op">&lt;-</span> <span class="fu">haven</span><span class="op">(</span><span class="st">"./data/ADVS.sas7bdat"</span><span class="op">)</span></span>
<span>  <span class="co">#%end</span></span>
<span></span>
<span><span class="co">#%else </span></span>
<span>  </span>
<span>  <span class="co"># Get adsl dataset</span></span>
<span>  <span class="va">adsl</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/readRDS.html" class="external-link">readRDS</a></span><span class="op">(</span><span class="st">"./data/ADSL.rds"</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co">#%if (any(c("PULSE", "TEMP", "BP") %in% anal_vars.))</span></span>
<span>  <span class="co"># Get advs dataset</span></span>
<span>  <span class="va">advs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/readRDS.html" class="external-link">readRDS</a></span><span class="op">(</span><span class="st">"./data/ADVS.rds"</span><span class="op">)</span></span>
<span>  <span class="co">#%end</span></span>
<span></span>
<span><span class="co">#%end</span></span></code></pre></div>
<p>When the nested conditionals resolve, they will look like this:</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">######################</span></span>
<span><span class="co"># Get data</span></span>
<span><span class="co">######################</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://haven.tidyverse.org" class="external-link">haven</a></span><span class="op">)</span></span>
<span></span>
<span>  <span class="co"># Get adsl dataset</span></span>
<span>  <span class="va">adsl</span> <span class="op">&lt;-</span> <span class="fu">haven</span><span class="op">(</span><span class="st">"./data/ADSL.sas7bdat"</span><span class="op">)</span></span>
<span></span>
<span>  <span class="co"># Get advs dataset</span></span>
<span>  <span class="va">advs</span> <span class="op">&lt;-</span> <span class="fu">haven</span><span class="op">(</span><span class="st">"./data/ADVS.sas7bdat"</span><span class="op">)</span></span></code></pre></div>
<p>In this way, you can perform complex logic in the macro
pre-processor, and still produce a concise output.</p>
</div>
</div>
</div>
<div class="section level2">
<h2 id="macro-include">Macro Include<a class="anchor" aria-label="anchor" href="#macro-include"></a>
</h2>
<div class="section level3">
<h3 id="syntax-3">Syntax<a class="anchor" aria-label="anchor" href="#syntax-3"></a>
</h3>
<pre><code><span><span class="co">#%include &lt;path&gt;</span></span>
<span><span class="co">#%include '&lt;path&gt;'</span></span>
<span><span class="co">#%include "&lt;path&gt;"</span></span></code></pre>
<p>Where “&lt;path&gt;” is a path to the file to include. The file path
may be quoted or unquoted. If the path is quoted, single or double
quotes may be used.</p>
</div>
<div class="section level3">
<h3 id="details-3">Details<a class="anchor" aria-label="anchor" href="#details-3"></a>
</h3>
<p>The <code>#%include()</code> macro command inserts text from an
external file into the generated output file. This behavior is different
from the Base R <code><a href="https://rdrr.io/r/base/source.html" class="external-link">source()</a></code> function, which only executes the
code from the external file. A macro include actually copies the code
into the generated file. The included code does not have to be fully
functional. It can be a code snippet that only works when combined with
other included code.</p>
</div>
<div class="section level3">
<h3 id="examples-3">Examples<a class="anchor" aria-label="anchor" href="#examples-3"></a>
</h3>
<p>The below example includes code from the file “dat01.R”. This file
contains a snippet of sample data:</p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Create sample data</span></span>
<span><span class="co">#%include "./templates/dat01.R"</span></span>
<span></span>
<span><span class="co"># Print sample data</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">dat</span><span class="op">)</span></span></code></pre></div>
<p>The resolved macro will look like this:</p>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Create sample data</span></span>
<span><span class="va">dat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html" class="external-link">read.table</a></span><span class="op">(</span>header <span class="op">=</span> <span class="cn">TRUE</span>, text <span class="op">=</span> <span class="st">'</span></span>
<span><span class="st">  SUBJID  ARM    SEX  RACE    AGE</span></span>
<span><span class="st">  "001"   "ARM A" "F"  "WHITE" 19 </span></span>
<span><span class="st">  "002"   "ARM B" "F"  "WHITE" 21 </span></span>
<span><span class="st">  "003"   "ARM C" "F"  "WHITE" 23 </span></span>
<span><span class="st">  "004"   "ARM D" "F"  "BLACK" 28 </span></span>
<span><span class="st">  "005"   "ARM A" "M"  "WHITE" 37  </span></span>
<span><span class="st">  "006"   "ARM B" "M"  "WHITE" 34 </span></span>
<span><span class="st">  "007"   "ARM C" "M"  "WHITE" 36  </span></span>
<span><span class="st">  "008"   "ARM D" "M"  "WHITE" 30   </span></span>
<span><span class="st">  "009"   "ARM A" "F"  "ASIAN" 39  </span></span>
<span><span class="st">  "010"   "ARM B" "F"  "WHITE" 31  </span></span>
<span><span class="st">  "011"   "ARM C" "F"  "BLACK" 33 </span></span>
<span><span class="st">  "012"   "ARM D" "F"  "WHITE" 38 </span></span>
<span><span class="st">  "013"   "ARM A" "M"  "BLACK" 37 </span></span>
<span><span class="st">  "014"   "ARM B" "M"  "WHITE" 34  </span></span>
<span><span class="st">  "015"   "ARM C" "M"  "ASIAN" 36</span></span>
<span><span class="st">  "016"   "ARM A" "M"  "WHITE" 40'</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Print sample data</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">dat</span><span class="op">)</span></span></code></pre></div>
<p>Notice that the included code is integrated with the surrounding code
from the macro-enabled program. In this way, you can collate a program
from multiple code snippets into a unified result.</p>
</div>
</div>
<div class="section level2">
<h2 id="macro-functions">Macro Functions<a class="anchor" aria-label="anchor" href="#macro-functions"></a>
</h2>
<p>The <strong>macro</strong> package currently supports three built-in
macro functions: <code>%sysfunc()</code>, <code>%symexist()</code>, and
<code>%symput()</code>.</p>
<div class="section level3">
<h3 id="syntax-4">Syntax<a class="anchor" aria-label="anchor" href="#syntax-4"></a>
</h3>
<pre><code>%sysfunc(&lt;expression&gt;, [&lt;format&gt;])</code></pre>
<p>Where “&lt;expression&gt;” is an R expression, and “&lt;format&gt;”
is an optional format code. The expression may contain R functions,
operators, hard-coded values, and macro variables. If “&lt;format&gt;”
is supplied, the function will apply the format after the expression is
resolved, and return the formatted value. The format code does not need
to be quoted. If the format is unquoted, the output of the
<code>%sysfunc()</code> function will be unquoted. If the format is
quoted, the output of the <code>%sysfunc()</code> function will be
quoted.</p>
<p>Note that the R <code>%sysfunc()</code> is a general evaluation
function. It can evaluate any R expression, even those that do not
resolve to a numeric value.</p>
<pre><code>%symexist(&lt;name&gt;)</code></pre>
<p>Where “&lt;name&gt;” is an unquoted name of a macro variable. If the
macro variable exists, the function will return TRUE. Otherwise, the
function will return FALSE.</p>
<pre><code>%symput(&lt;expression&gt;)</code></pre>
<p>Where “&lt;expression&gt;” is an R expression that references the
execution environment. The expression can contain macro variables. The
return value from <code>%symput()</code> is assigned to a macro variable
using a <code>#%let</code> command. The <code>%symput()</code> function
must exist as part of a <code>#%let</code> statement. It cannot be used
with any other R macro command.</p>
</div>
<div class="section level3">
<h3 id="details-4">Details<a class="anchor" aria-label="anchor" href="#details-4"></a>
</h3>
<p>The <code>%sysfunc()</code>, <code>%symexist()</code>, and
<code>%symput()</code> functions are helper functions that are usually
contained in other macro statements. Most commonly, they will exist as
part of “let” or “if” statement. For this reason, the syntax does not
include a leading comment symbol (“#”).</p>
<p>The purpose of <code>%sysfunc()</code> is to evaluate regular R
expressions during macro processing. The evaluated result can then be
assigned to a macro variable, or used in a macro condition.</p>
<p>The purpose of <code>%symexist()</code> is to check for the existence
of a macro variable. This check is likewise most often performed as part
of a macro conditional expression.</p>
<p>The purpose of <code>%symput()</code> is to evaluate an expression in
the execution environment and assign it to a macro variable in the macro
environment.</p>
<p>Normally, the macro commands in a program are resolved first, and
then the remaining R code is executed. Sometimes, however, you want to
make decisions in the macro code depending on what is going on in the
regular R code. For example, if your input dataset has no rows, you may
decide do something differently in the macro logic. It is for this type
of situation that <code>symput()</code> was designed for.</p>
<p>When the macro pre-processor encounters a <code>%symput()</code>
function, it will first evaluate all emitted code. Then it will evaluate
and return the expression inside the <code>%symput()</code>.</p>
<p>SAS programmers will notice that the R <code>%symput()</code>
function is quite different from the SAS version. But they have the same
goal.</p>
</div>
<div class="section level3">
<h3 id="examples-4">Examples<a class="anchor" aria-label="anchor" href="#examples-4"></a>
</h3>
<div class="section level4">
<h4 id="sysfunc">%sysfunc()<a class="anchor" aria-label="anchor" href="#sysfunc"></a>
</h4>
<p>Here are some examples illustrating the basic operation of
<code>%sysfunc()</code>:</p>
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#% Unevaluated assignment</span></span>
<span><span class="co">#%let a &lt;- 2 + 2</span></span>
<span><span class="va">w</span> <span class="op">&lt;-</span> <span class="va">a.</span></span>
<span></span>
<span><span class="co">#% Evaluated assignment</span></span>
<span><span class="co">#%let b &lt;- %sysfunc(2 + 2)</span></span>
<span><span class="va">x</span> <span class="op">&lt;-</span> <span class="va">b.</span></span>
<span></span>
<span><span class="co">#% Unevaluated replacement </span></span>
<span><span class="co">#%let c &lt;- a. + b.</span></span>
<span><span class="va">y</span> <span class="op">&lt;-</span> <span class="va">c.</span></span>
<span></span>
<span><span class="co">#% Evaluated replacement</span></span>
<span><span class="co">#%let d &lt;- %sysfunc(a. + b.)</span></span>
<span><span class="va">z</span> <span class="op">&lt;-</span> <span class="va">d.</span></span>
<span>  </span></code></pre></div>
<p>The above code resolves as follows:</p>
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">w</span> <span class="op">&lt;-</span> <span class="fl">2</span> <span class="op">+</span> <span class="fl">2</span></span>
<span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fl">4</span></span>
<span><span class="va">y</span> <span class="op">&lt;-</span> <span class="fl">2</span> <span class="op">+</span> <span class="fl">2</span> <span class="op">+</span> <span class="fl">4</span></span>
<span><span class="va">z</span> <span class="op">&lt;-</span> <span class="fl">8</span></span></code></pre></div>
<p>Observe the different ways each expression resolves depending on the
usage <code>%sysfunc()</code>.</p>
<p>Here is another example:</p>
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#%let a &lt;- c(1.205, 4.683, 3.812, 6.281, 9.467)</span></span>
<span></span>
<span><span class="co">#%if (%sysfunc(mean(a.)) &gt; 5)</span></span>
<span><span class="va">x</span> <span class="op">&lt;-</span> <span class="st">"&gt; 5"</span></span>
<span><span class="co">#%else </span></span>
<span><span class="va">x</span> <span class="op">&lt;-</span> <span class="st">"&lt;= 5"</span></span>
<span><span class="co">#%end</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="st">"The mean of 'a' is %sysfunc(mean(a., %.2f))"</span><span class="op">)</span></span></code></pre></div>
<p>The above macro function evaluates the mean of <code>a.</code>,
compares to the hard-coded value 5, and then sets the value of
<code>x</code>. The <code>%sysfunc()</code> macro function allows for
immediate evaluation of the Base R <code><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean()</a></code> function.</p>
<p>Here is the resolved code:</p>
<div class="sourceCode" id="cb34"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x</span> <span class="op">&lt;-</span> <span class="st">"&gt;5"</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="st">"The mean of 'a' is 5.09"</span><span class="op">)</span></span></code></pre></div>
<p>In the above example, <code>%sysfunc()</code> is used in the
conditional, and inside a text string. You can see that it is resolved
in both cases.</p>
<p>Note that you do not need multiple calls to <code>%sysfunc()</code>
if you have multiple Base R functions in your expression. Just put your
entire expression inside one call to <code>%sysfunc()</code> and it will
evaluate as desired.</p>
</div>
<div class="section level4">
<h4 id="symexist">%symexist()<a class="anchor" aria-label="anchor" href="#symexist"></a>
</h4>
<p>Below is a simple example checking for the existence of some macro
variables before using them in a calculation:</p>
<div class="sourceCode" id="cb35"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#% Check for existance of a</span></span>
<span><span class="co">#%if (%symexist(a) == FALSE)</span></span>
<span>  <span class="co">#%let a &lt;- 2</span></span>
<span><span class="co">#%end</span></span>
<span></span>
<span><span class="co">#% Check for existance of b</span></span>
<span><span class="co">#%if (%symexist(b) == FALSE)</span></span>
<span>  <span class="co">#%let b &lt;- 3</span></span>
<span><span class="co">#%end</span></span>
<span></span>
<span><span class="co"># Calculate a * b</span></span>
<span><span class="va">x</span> <span class="op">&lt;-</span> <span class="va">a.</span> <span class="op">*</span> <span class="va">b.</span></span></code></pre></div>
<p>And here is the resolved version:</p>
<div class="sourceCode" id="cb36"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Calculate a * b</span></span>
<span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fl">2</span> <span class="op">*</span> <span class="fl">3</span></span></code></pre></div>
<p>Notice that the variable name inside the <code>%symexist()</code>
function is not quoted. For this function, quoting is not necessary, and
will in fact prevent the function from finding the specified variable
name.</p>
</div>
<div class="section level4">
<h4 id="symput">%symput()<a class="anchor" aria-label="anchor" href="#symput"></a>
</h4>
<p>Examine the following code. In this code, we are trying to get the
length of a vector into a macro variable:</p>
<div class="sourceCode" id="cb37"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Assign vector</span></span>
<span><span class="va">v1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"one"</span>, <span class="st">"two"</span>, <span class="st">"three"</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#% Get length of vector</span></span>
<span><span class="co">#%let x &lt;- %symput(length(v1))</span></span>
<span></span>
<span><span class="co">#% Get vector values</span></span>
<span><span class="co">#%let y &lt;- %symput(v1)</span></span>
<span></span>
<span><span class="co"># Use macro variables</span></span>
<span><span class="va">a</span> <span class="op">&lt;-</span> <span class="va">x.</span></span>
<span><span class="va">b</span> <span class="op">&lt;-</span> <span class="va">y.</span></span></code></pre></div>
<p>If you run the above code in <code><a href="../reference/msource.html">msource()</a></code>, you will get the
following output:</p>
<pre><code>&gt; msource()
[1] 3
[1] "one"   "two"   "three"</code></pre>
<p>And the generated code looks like this:</p>
<div class="sourceCode" id="cb39"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Assign vector</span></span>
<span><span class="va">v1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"one"</span>, <span class="st">"two"</span>, <span class="st">"three"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Use macro variables</span></span>
<span><span class="va">a</span> <span class="op">&lt;-</span> <span class="fl">3</span></span>
<span><span class="va">b</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'one'</span>, <span class="st">'two'</span>, <span class="st">'three'</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Print to console</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">a</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">b</span><span class="op">)</span></span></code></pre></div>
<p>You can see the length and value of vector ‘v1’ has been pulled from
the normal R code into macro variables. These macro variables can then
be used with other macro commands to control what happens during
pre-processing.</p>
</div>
</div>
</div>
<div class="section level2">
<h2 id="macro-do-loops">Macro Do Loops<a class="anchor" aria-label="anchor" href="#macro-do-loops"></a>
</h2>
<div class="section level3">
<h3 id="syntax-5">Syntax<a class="anchor" aria-label="anchor" href="#syntax-5"></a>
</h3>
<pre><code><span><span class="co">#%do &lt;variable&gt; = &lt;start&gt; %to &lt;end&gt;</span></span>
<span><span class="co">#%end</span></span></code></pre>
<p>Where “&lt;variable&gt;” is a macro variable name to use for the loop
counter, and “&lt;start&gt;” and “&lt;end&gt;” signify the beginning and
ending of the loop sequence. The “&lt;start&gt;” and “&lt;end&gt;”
values can be numbers, macro variables that resolve to numbers, or
expressions that resolve to numbers.</p>
<p>The “#%end” command signifies the end of the “do” block. It is
required.</p>
</div>
<div class="section level3">
<h3 id="details-5">Details<a class="anchor" aria-label="anchor" href="#details-5"></a>
</h3>
<p>A macro “do” loop causes the pre-processor to repeat a section of
code some number of times. The do variable will be incremented for each
pass. This variable can be used to alter the section of code each time
around. In the generated output file, the do block code will actually be
copied for each iteration of the loop.</p>
</div>
<div class="section level3">
<h3 id="examples-5">Examples<a class="anchor" aria-label="anchor" href="#examples-5"></a>
</h3>
<p>Here is a simple example of a macro do loop:</p>
<div class="sourceCode" id="cb41"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#%do x = 1 %to 3</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="st">"Hello #x."</span><span class="op">)</span></span>
<span><span class="co">#%end</span></span></code></pre></div>
<p>The console output from the above macro do loop is as follows:</p>
<div class="sourceCode" id="cb42"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" tabindex="-1"></a><span class="sc">&gt;</span> <span class="fu">msource</span>()</span>
<span id="cb42-2"><a href="#cb42-2" tabindex="-1"></a>[<span class="dv">1</span>] <span class="st">"Hello #1"</span></span>
<span id="cb42-3"><a href="#cb42-3" tabindex="-1"></a>[<span class="dv">1</span>] <span class="st">"Hello #2"</span></span>
<span id="cb42-4"><a href="#cb42-4" tabindex="-1"></a>[<span class="dv">1</span>] <span class="st">"Hello #3"</span></span></code></pre></div>
<p>And the generated code is as follows:</p>
<div class="sourceCode" id="cb43"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="st">"Hello #1"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="st">"Hello #2"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="st">"Hello #3"</span><span class="op">)</span></span></code></pre></div>
<p>Observe that the code inside the macro do loop was copied for each
iteration of the loop.</p>
<p>Here is a more interesting example:</p>
<div class="sourceCode" id="cb44"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#%let vars &lt;- c("mpg", "disp", "hp", "drat")</span></span>
<span><span class="co"># Get data</span></span>
<span><span class="va">dat</span> <span class="op">&lt;-</span> <span class="va">mtcars</span></span>
<span></span>
<span></span>
<span><span class="co">#% Print mean for each variable</span></span>
<span><span class="co">#%do v = 1 %to length(vars.)</span></span>
<span><span class="co">#%let var &lt;- %sysfunc(vars.[v.])</span></span>
<span></span>
<span><span class="co"># Calculate mean for var.</span></span>
<span><span class="va">mnv.</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sprintf.html" class="external-link">sprintf</a></span><span class="op">(</span><span class="st">"%.2f"</span>, <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">dat</span><span class="op">$</span><span class="va">var.</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"Mean of 'var.' is "</span>, <span class="va">mnv.</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#%end</span></span></code></pre></div>
<p>This example calculates the mean for several variables in the
“mtcars” sample data frame. The macro loops through a vector of
variables and constructs a code block for each variable.</p>
<p>Here is the console output from the generated code:</p>
<pre><code>&gt; msource()
[1] "Mean of 'mpg' is 20.09"
[1] "Mean of 'disp' is 230.72"
[1] "Mean of 'hp' is 146.69"
[1] "Mean of 'drat' is 3.60"</code></pre>
<p>And here is the generated code:</p>
<div class="sourceCode" id="cb46"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Get data</span></span>
<span><span class="va">dat</span> <span class="op">&lt;-</span> <span class="va">mtcars</span></span>
<span></span>
<span><span class="co"># Calculate mean for mpg</span></span>
<span><span class="va">mn1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sprintf.html" class="external-link">sprintf</a></span><span class="op">(</span><span class="st">"%.2f"</span>, <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">dat</span><span class="op">$</span><span class="va">mpg</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"Mean of 'mpg' is "</span>, <span class="va">mn1</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Calculate mean for disp</span></span>
<span><span class="va">mn2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sprintf.html" class="external-link">sprintf</a></span><span class="op">(</span><span class="st">"%.2f"</span>, <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">dat</span><span class="op">$</span><span class="va">disp</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"Mean of 'disp' is "</span>, <span class="va">mn2</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Calculate mean for hp</span></span>
<span><span class="va">mn3</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sprintf.html" class="external-link">sprintf</a></span><span class="op">(</span><span class="st">"%.2f"</span>, <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">dat</span><span class="op">$</span><span class="va">hp</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"Mean of 'hp' is "</span>, <span class="va">mn3</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Calculate mean for drat</span></span>
<span><span class="va">mn4</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sprintf.html" class="external-link">sprintf</a></span><span class="op">(</span><span class="st">"%.2f"</span>, <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">dat</span><span class="op">$</span><span class="va">drat</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"Mean of 'drat' is "</span>, <span class="va">mn4</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>Notice that the macro functionality can be used to create variable
names dynamically. The macro system can also produce comments and other
statements dynamically. Because the macro language is a text replacement
language, any part of the code is available for manipulation.</p>
<p>Next: <a href="macro-debug.html">Debugging</a></p>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

      </div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by David Bosak.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.0.</p>
</div>

      </footer>
</div>






  </body>
</html>

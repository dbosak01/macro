<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Example 3: Table • macro</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js" integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Example 3: Table">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">


    <div class="container template-article">
      <header><div class="navbar navbar-inverse navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">macro</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.1.2</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav"></ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="../articles/macro.html">Get started</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles

    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/macro-language.html">Macro Language</a>
    </li>
    <li>
      <a href="../articles/macro-debug.html">Debugging</a>
    </li>
    <li>
      <a href="../articles/macro-example1.html">Example 1: Listing</a>
    </li>
    <li>
      <a href="../articles/macro-example2.html">Example 2: Another Listing</a>
    </li>
    <li>
      <a href="../articles/macro-example3.html">Example 3: Table</a>
    </li>
    <li>
      <a href="../articles/macro-disclaimer.html">Disclaimer</a>
    </li>
    <li>
      <a href="../articles/macro-faq.html">Frequently Asked Questions</a>
    </li>
  </ul>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li>
  <a href=".././articles/macro-faq.html">FAQ</a>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
<li>
  <a href="https://github.com/dbosak01/macro/" class="external-link">
    <span class="fab fa-github fa-lg"></span>

  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->



      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Example 3: Table</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/dbosak01/macro/blob/HEAD/vignettes/macro-example3.Rmd" class="external-link"><code>vignettes/macro-example3.Rmd</code></a></small>
      <div class="hidden name"><code>macro-example3.Rmd</code></div>

    </div>

    
    
<p>Now let’s look at a still more complicated example. For this example,
we want to create a demographics table that can be used across different
studies. Therefore, we’ll need to let the user pass in parameters like
treatment groups, the path to the data, and which variables to include
in the analysis. The <strong>macro</strong> package makes it easy to
create such a parameterized table.</p>
<div class="section level2">
<h2 id="generate-a-demographics-table">Generate a Demographics Table<a class="anchor" aria-label="anchor" href="#generate-a-demographics-table"></a>
</h2>
<p>To generate the table, we will need four files:</p>
<ul>
<li>A macro driver script</li>
<li>A template table program</li>
<li>A sample data code snippet</li>
<li>A report code snippet</li>
</ul>
<div class="section level3">
<h3 id="macro-driver-script">Macro Driver Script<a class="anchor" aria-label="anchor" href="#macro-driver-script"></a>
</h3>
<p>In the second listing example, we assigned macro parameters directly
in R code.<br>
That technique will be used again here:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="co"># Assign base path</span></span>
<span><span class="va">base_path</span> <span class="op">&lt;-</span> <span class="st">"./macro/code"</span></span>
<span></span>
<span><span class="co"># Assign relative paths</span></span>
<span><span class="va">log_path.</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">base_path</span>, <span class="st">"log"</span><span class="op">)</span></span>
<span><span class="va">output_path.</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">base_path</span>, <span class="st">"output"</span><span class="op">)</span></span>
<span><span class="va">template_path.</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">base_path</span>, <span class="st">"templates"</span><span class="op">)</span></span>
<span><span class="va">data_path.</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">base_path</span>, <span class="st">"data"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Assign global variables</span></span>
<span><span class="va">sponsor_name.</span> <span class="op">&lt;-</span> <span class="st">"Acme, Inc."</span></span>
<span><span class="va">study_name.</span> <span class="op">&lt;-</span> <span class="st">"ABC"</span></span>
<span><span class="va">prog_nm.</span> <span class="op">&lt;-</span> <span class="st">"t_dm"</span></span>
<span></span>
<span><span class="co"># Select analysis variables </span></span>
<span><span class="va">vars.</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"age"</span>, <span class="st">"ageg"</span><span class="op">)</span> <span class="co"># "sex", "race"</span></span>
<span></span>
<span><span class="co"># Assign or get titles</span></span>
<span><span class="va">titles.</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Table 1.0"</span>, </span>
<span>             <span class="st">"Analysis of Demographic Characteristics"</span>,</span>
<span>             <span class="st">"Safety Population"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Assign or get footnotes</span></span>
<span><span class="va">footnotes.</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"Program: "</span>, <span class="va">prog_nm.</span>, <span class="st">".R"</span><span class="op">)</span>,</span>
<span>                <span class="st">"NOTE: Denominator based on number of non-missing responses."</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Assign treatment groups and labels</span></span>
<span><span class="va">trt_grps.</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"ARM A"</span> <span class="op">=</span> <span class="st">"Placebo"</span>, <span class="st">"ARM B"</span> <span class="op">=</span> <span class="st">"Drug 50mg"</span>, <span class="st">"ARM C"</span> <span class="op">=</span> <span class="st">"Drug 100mg"</span>,</span>
<span>              <span class="st">"ARM D"</span> <span class="op">=</span> <span class="st">"Competitor"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Assign other parameters</span></span>
<span><span class="va">env.</span> <span class="op">&lt;-</span> <span class="st">"dev"</span> <span class="co"># "prod"</span></span>
<span><span class="va">out_type.</span> <span class="op">&lt;-</span> <span class="st">"PDF"</span></span>
<span></span>
<span><span class="co"># Preprocess and Run Example3</span></span>
<span><span class="fu">macro</span><span class="fu">::</span><span class="fu"><a href="../reference/msource.html">msource</a></span><span class="op">(</span><span class="st">"./macro/Example3.R"</span>, <span class="st">"./macro/code/t_dm.R"</span><span class="op">)</span></span></code></pre></div>
<p>Observe that there are four possible analysis variables for this
demographics table: “age”, “ageg”, “sex”, and “race”. The program allows
the user to pick which variables will be added to the final report. The
template table program will conditionalize the code on the selected
analysis variables.</p>
</div>
<div class="section level3">
<h3 id="template-table-program">Template Table Program<a class="anchor" aria-label="anchor" href="#template-table-program"></a>
</h3>
<p>Here is the macro-enabled template program that the above driver is
calling:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#####################################################################</span></span>
<span><span class="co"># Program Name: prog_name.</span></span>
<span><span class="co"># Study: study_name.</span></span>
<span><span class="co">#####################################################################</span></span>
<span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://r-sassy.org" class="external-link">sassy</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Prepare Log -------------------------------------------------------------</span></span>
<span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/options.html" class="external-link">options</a></span><span class="op">(</span><span class="st">"logr.autolog"</span> <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>        <span class="st">"logr.on"</span> <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>        <span class="st">"logr.notes"</span> <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>        <span class="st">"procs.print"</span> <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Assign program name</span></span>
<span><span class="va">prog_nm</span> <span class="op">&lt;-</span> <span class="st">"prog_nm."</span></span>
<span></span>
<span><span class="co"># Construct paths</span></span>
<span><span class="va">l_path</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="st">"log_path."</span>, <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">prog_nm</span>, <span class="st">".log"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">o_path</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="st">"output_path."</span>, <span class="va">prog_nm</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Open log</span></span>
<span><span class="va">lf</span> <span class="op">&lt;-</span> <span class="fu">log_open</span><span class="op">(</span><span class="va">l_path</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Prepare formats ---------------------------------------------------------</span></span>
<span></span>
<span><span class="fu">sep</span><span class="op">(</span><span class="st">"Prepare formats"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">put</span><span class="op">(</span><span class="st">"Compile format catalog"</span><span class="op">)</span></span>
<span><span class="va">fc</span> <span class="op">&lt;-</span> <span class="fu">fcat</span><span class="op">(</span>MEAN <span class="op">=</span> <span class="st">"%.1f"</span>, STD <span class="op">=</span> <span class="st">"(%.2f)"</span>, </span>
<span>           Q1 <span class="op">=</span> <span class="st">"%.1f"</span>, Q3 <span class="op">=</span> <span class="st">"%.1f"</span>,</span>
<span>           MIN <span class="op">=</span> <span class="st">"%d"</span>, MAX <span class="op">=</span> <span class="st">"%d"</span>, </span>
<span>           CNT <span class="op">=</span> <span class="st">"%2d"</span>, PCT <span class="op">=</span> <span class="st">"(%5.1f%%)"</span><span class="op">)</span> </span>
<span></span>
<span><span class="co"># Load and Prepare Data ---------------------------------------------------</span></span>
<span></span>
<span><span class="fu">sep</span><span class="op">(</span><span class="st">"Prepare Data"</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#%if ("env." == "prod")</span></span>
<span></span>
<span><span class="fu">put</span><span class="op">(</span><span class="st">"Get data"</span><span class="op">)</span></span>
<span><span class="fu">libname</span><span class="op">(</span><span class="va">dat</span>, <span class="st">"data_path."</span>, <span class="st">"Rda"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">adsl</span> <span class="op">&lt;-</span> <span class="va">dat</span><span class="op">$</span><span class="va">dm</span></span>
<span></span>
<span><span class="co">#%else </span></span>
<span></span>
<span><span class="fu">put</span><span class="op">(</span><span class="st">"Create sample ADSL data."</span><span class="op">)</span></span>
<span><span class="co">#%include 'template_path./dat01.R'</span></span>
<span></span>
<span><span class="co">#%end</span></span>
<span></span>
<span><span class="fu">put</span><span class="op">(</span><span class="st">"Log starting dataset"</span><span class="op">)</span></span>
<span><span class="fu">put</span><span class="op">(</span><span class="va">adsl</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">put</span><span class="op">(</span><span class="st">"Filter out screen failure"</span><span class="op">)</span></span>
<span><span class="va">adsl_f</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="va">adsl</span>, <span class="va">ARM</span> <span class="op">!=</span> <span class="st">'SCREEN FAILURE'</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="fu">put</span><span class="op">(</span><span class="st">"Get ARM population counts"</span><span class="op">)</span></span>
<span><span class="fu">proc_freq</span><span class="op">(</span><span class="va">adsl_f</span>, tables <span class="op">=</span> <span class="va">ARM</span>, </span>
<span>          output <span class="op">=</span> <span class="va">long</span>,</span>
<span>          options <span class="op">=</span> <span class="fu"><a href="https://common.r-sassy.org/reference/v.html" class="external-link">v</a></span><span class="op">(</span><span class="va">nopercent</span>, <span class="va">nonobs</span><span class="op">)</span><span class="op">)</span> <span class="op">-&gt;</span> <span class="va">arm_pop</span></span>
<span></span>
<span><span class="fu">put</span><span class="op">(</span><span class="st">"Log treatment groups variable"</span><span class="op">)</span></span>
<span><span class="va">trt_grps</span> <span class="op">&lt;-</span> <span class="va">trt_grps.</span></span>
<span><span class="fu">put</span><span class="op">(</span><span class="va">trt_grps</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Initialize block variables ----------------------------------------------</span></span>
<span></span>
<span><span class="co"># Initialize final dataset</span></span>
<span><span class="va">final</span> <span class="op">&lt;-</span> <span class="cn">NULL</span></span>
<span></span>
<span><span class="co">#%if ("age" %in% vars.)</span></span>
<span></span>
<span><span class="co"># Age Summary Block -------------------------------------------------------</span></span>
<span></span>
<span><span class="fu">sep</span><span class="op">(</span><span class="st">"Create summary statistics for age"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">put</span><span class="op">(</span><span class="st">"Call means procedure to get summary statistics for age"</span><span class="op">)</span></span>
<span><span class="fu">proc_means</span><span class="op">(</span><span class="va">adsl_f</span>, var <span class="op">=</span> <span class="va">AGE</span>,</span>
<span>           stats <span class="op">=</span> <span class="fu"><a href="https://common.r-sassy.org/reference/v.html" class="external-link">v</a></span><span class="op">(</span><span class="va">n</span>, <span class="va">mean</span>, <span class="va">std</span>, <span class="va">median</span>, <span class="va">q1</span>, <span class="va">q3</span>, <span class="va">min</span>, <span class="va">max</span><span class="op">)</span>,</span>
<span>           by <span class="op">=</span> <span class="va">ARM</span>, </span>
<span>           options <span class="op">=</span> <span class="fu"><a href="https://common.r-sassy.org/reference/v.html" class="external-link">v</a></span><span class="op">(</span><span class="va">notype</span>, <span class="va">nofreq</span><span class="op">)</span><span class="op">)</span> <span class="op">-&gt;</span> <span class="va">age_stats</span> </span>
<span></span>
<span><span class="fu">put</span><span class="op">(</span><span class="st">"Combine stats"</span><span class="op">)</span></span>
<span><span class="fu">datastep</span><span class="op">(</span><span class="va">age_stats</span>, </span>
<span>         format <span class="op">=</span> <span class="va">fc</span>,</span>
<span>         drop <span class="op">=</span> <span class="fu"><a href="https://common.r-sassy.org/reference/find.names.html" class="external-link">find.names</a></span><span class="op">(</span><span class="va">age_stats</span>, start <span class="op">=</span> <span class="fl">4</span><span class="op">)</span>, </span>
<span>         <span class="op">{</span></span>
<span>           <span class="va">VAR</span> <span class="op">&lt;-</span> <span class="st">"Age"</span></span>
<span>           <span class="va">`Mean (SD)`</span> <span class="op">&lt;-</span> <span class="fu">fapply2</span><span class="op">(</span><span class="va">MEAN</span>, <span class="va">STD</span><span class="op">)</span></span>
<span>           <span class="va">Median</span> <span class="op">&lt;-</span> <span class="va">MEDIAN</span></span>
<span>           <span class="va">`Q1 - Q3`</span> <span class="op">&lt;-</span> <span class="fu">fapply2</span><span class="op">(</span><span class="va">Q1</span>, <span class="va">Q3</span>, sep <span class="op">=</span> <span class="st">" - "</span><span class="op">)</span></span>
<span>           <span class="va">`Min - Max`</span> <span class="op">&lt;-</span> <span class="fu">fapply2</span><span class="op">(</span><span class="va">MIN</span>, <span class="va">MAX</span>, sep <span class="op">=</span> <span class="st">" - "</span><span class="op">)</span></span>
<span>           </span>
<span>           </span>
<span>         <span class="op">}</span><span class="op">)</span> <span class="op">-&gt;</span> <span class="va">age_comb</span></span>
<span></span>
<span><span class="fu">put</span><span class="op">(</span><span class="st">"Transpose ARMs into columns"</span><span class="op">)</span></span>
<span><span class="fu">proc_transpose</span><span class="op">(</span><span class="va">age_comb</span>, </span>
<span>               var <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">age_comb</span><span class="op">)</span>,</span>
<span>               copy <span class="op">=</span> <span class="va">VAR</span>, id <span class="op">=</span> <span class="va">BY</span>, </span>
<span>               name <span class="op">=</span> <span class="va">LABEL</span><span class="op">)</span> <span class="op">-&gt;</span> <span class="va">age_block</span> </span>
<span></span>
<span><span class="fu">put</span><span class="op">(</span><span class="st">"Append results"</span><span class="op">)</span></span>
<span><span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NULL.html" class="external-link">is.null</a></span><span class="op">(</span><span class="va">final</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">final</span> <span class="op">&lt;-</span> <span class="va">age_block</span></span>
<span><span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span>  <span class="va">final</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span><span class="va">final</span>, <span class="va">age_block</span><span class="op">)</span> </span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co">#%end</span></span>
<span></span>
<span><span class="co">#%if ("ageg" %in% vars.)</span></span>
<span></span>
<span><span class="co"># Age Group Block ----------------------------------------------------------</span></span>
<span></span>
<span><span class="fu">sep</span><span class="op">(</span><span class="st">"Create frequency counts for Age Group"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">put</span><span class="op">(</span><span class="st">"Age categories"</span><span class="op">)</span></span>
<span><span class="va">agecat</span> <span class="op">&lt;-</span> <span class="fu">value</span><span class="op">(</span><span class="fu">condition</span><span class="op">(</span><span class="va">x</span> <span class="op">&gt;=</span> <span class="fl">18</span> <span class="op">&amp;</span> <span class="va">x</span> <span class="op">&lt;=</span> <span class="fl">29</span>, <span class="st">"18 to 29"</span><span class="op">)</span>,</span>
<span>                <span class="fu">condition</span><span class="op">(</span><span class="va">x</span> <span class="op">&gt;=</span><span class="fl">30</span> <span class="op">&amp;</span> <span class="va">x</span> <span class="op">&lt;=</span> <span class="fl">39</span>, <span class="st">"30 to 39"</span><span class="op">)</span>,</span>
<span>                <span class="fu">condition</span><span class="op">(</span><span class="va">x</span> <span class="op">&gt;=</span><span class="fl">40</span> <span class="op">&amp;</span> <span class="va">x</span> <span class="op">&lt;=</span><span class="fl">49</span>, <span class="st">"40 to 49"</span><span class="op">)</span>,</span>
<span>                <span class="fu">condition</span><span class="op">(</span><span class="va">x</span> <span class="op">&gt;=</span> <span class="fl">50</span>, <span class="st">"&gt;= 50"</span><span class="op">)</span>,</span>
<span>                as.factor <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> </span>
<span></span>
<span><span class="fu">put</span><span class="op">(</span><span class="st">"Categorize AGE"</span><span class="op">)</span></span>
<span><span class="va">adsl_f</span><span class="op">$</span><span class="va">AGECAT</span> <span class="op">&lt;-</span> <span class="fu">fapply</span><span class="op">(</span><span class="va">adsl_f</span><span class="op">$</span><span class="va">AGE</span>, <span class="va">agecat</span><span class="op">)</span> </span>
<span></span>
<span><span class="fu">put</span><span class="op">(</span><span class="st">"Get age group frequency counts"</span><span class="op">)</span></span>
<span><span class="fu">proc_freq</span><span class="op">(</span><span class="va">adsl_f</span>,</span>
<span>          table <span class="op">=</span> <span class="va">AGECAT</span>,</span>
<span>          by <span class="op">=</span> <span class="va">ARM</span>,</span>
<span>          options <span class="op">=</span> <span class="va">nonobs</span><span class="op">)</span> <span class="op">-&gt;</span> <span class="va">ageg_freq</span></span>
<span></span>
<span><span class="fu">put</span><span class="op">(</span><span class="st">"Combine counts and percents and assign age group factor for sorting"</span><span class="op">)</span></span>
<span><span class="fu">datastep</span><span class="op">(</span><span class="va">ageg_freq</span>,</span>
<span>         format <span class="op">=</span> <span class="va">fc</span>, </span>
<span>         keep <span class="op">=</span> <span class="fu"><a href="https://common.r-sassy.org/reference/v.html" class="external-link">v</a></span><span class="op">(</span><span class="va">VAR</span>, <span class="va">LABEL</span>, <span class="va">BY</span>, <span class="va">CNTPCT</span><span class="op">)</span>,</span>
<span>         <span class="op">{</span></span>
<span>           <span class="va">VAR</span> <span class="op">&lt;-</span> <span class="st">"Age Group"</span></span>
<span>           <span class="va">CNTPCT</span> <span class="op">&lt;-</span> <span class="fu">fapply2</span><span class="op">(</span><span class="va">CNT</span>, <span class="va">PCT</span><span class="op">)</span></span>
<span>           <span class="va">LABEL</span> <span class="op">&lt;-</span> <span class="va">CAT</span></span>
<span>         <span class="op">}</span><span class="op">)</span> <span class="op">-&gt;</span> <span class="va">ageg_comb</span></span>
<span></span>
<span></span>
<span><span class="fu">put</span><span class="op">(</span><span class="st">"Sort by age group factor"</span><span class="op">)</span></span>
<span><span class="fu">proc_sort</span><span class="op">(</span><span class="va">ageg_comb</span>, by <span class="op">=</span> <span class="fu"><a href="https://common.r-sassy.org/reference/v.html" class="external-link">v</a></span><span class="op">(</span><span class="va">BY</span>, <span class="va">LABEL</span><span class="op">)</span><span class="op">)</span> <span class="op">-&gt;</span> <span class="va">ageg_sort</span> </span>
<span></span>
<span><span class="fu">put</span><span class="op">(</span><span class="st">"Tranpose age group block"</span><span class="op">)</span></span>
<span><span class="fu">proc_transpose</span><span class="op">(</span><span class="va">ageg_sort</span>,</span>
<span>               var <span class="op">=</span> <span class="va">CNTPCT</span>,</span>
<span>               copy <span class="op">=</span> <span class="va">VAR</span>,</span>
<span>               id <span class="op">=</span> <span class="va">BY</span>,</span>
<span>               by <span class="op">=</span> <span class="va">LABEL</span>, </span>
<span>               options <span class="op">=</span> <span class="va">noname</span><span class="op">)</span> <span class="op">-&gt;</span> <span class="va">ageg_block</span> </span>
<span></span>
<span><span class="fu">put</span><span class="op">(</span><span class="st">"Append results"</span><span class="op">)</span></span>
<span><span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NULL.html" class="external-link">is.null</a></span><span class="op">(</span><span class="va">final</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">final</span> <span class="op">&lt;-</span> <span class="va">ageg_block</span></span>
<span><span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span>  <span class="va">final</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span><span class="va">final</span>, <span class="va">ageg_block</span><span class="op">)</span> </span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co">#%end</span></span>
<span></span>
<span><span class="co">#%if ("sex" %in% vars.)</span></span>
<span></span>
<span><span class="co"># Sex Block ---------------------------------------------------------------</span></span>
<span></span>
<span><span class="fu">sep</span><span class="op">(</span><span class="st">"Create frequency counts for SEX"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">put</span><span class="op">(</span><span class="st">"Sex decodes"</span><span class="op">)</span></span>
<span><span class="va">fmt_sex</span> <span class="op">&lt;-</span> <span class="fu">value</span><span class="op">(</span><span class="fu">condition</span><span class="op">(</span><span class="va">x</span> <span class="op">==</span> <span class="st">"M"</span>, <span class="st">"Male"</span><span class="op">)</span>,</span>
<span>                 <span class="fu">condition</span><span class="op">(</span><span class="va">x</span> <span class="op">==</span> <span class="st">"F"</span>, <span class="st">"Female"</span><span class="op">)</span>,</span>
<span>                 <span class="fu">condition</span><span class="op">(</span><span class="cn">TRUE</span>, <span class="st">"Other"</span><span class="op">)</span>,</span>
<span>                 as.factor <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> </span>
<span></span>
<span><span class="fu">put</span><span class="op">(</span><span class="st">"Get sex frequency counts"</span><span class="op">)</span></span>
<span><span class="fu">proc_freq</span><span class="op">(</span><span class="va">adsl_f</span>, tables <span class="op">=</span> <span class="va">SEX</span>,</span>
<span>          by <span class="op">=</span> <span class="va">ARM</span>,</span>
<span>          options <span class="op">=</span> <span class="va">nonobs</span><span class="op">)</span> <span class="op">-&gt;</span> <span class="va">sex_freq</span> </span>
<span></span>
<span></span>
<span><span class="fu">put</span><span class="op">(</span><span class="st">"Combine counts and percents."</span><span class="op">)</span></span>
<span><span class="fu">datastep</span><span class="op">(</span><span class="va">sex_freq</span>, </span>
<span>         format <span class="op">=</span> <span class="va">fc</span>, </span>
<span>         rename <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>CAT <span class="op">=</span> <span class="st">"LABEL"</span><span class="op">)</span>,</span>
<span>         drop <span class="op">=</span> <span class="fu"><a href="https://common.r-sassy.org/reference/v.html" class="external-link">v</a></span><span class="op">(</span><span class="va">CNT</span>, <span class="va">PCT</span><span class="op">)</span>, </span>
<span>         <span class="op">{</span></span>
<span>           </span>
<span>           <span class="va">VAR</span> <span class="op">&lt;-</span> <span class="st">"Sex"</span></span>
<span>           <span class="va">CNTPCT</span> <span class="op">&lt;-</span> <span class="fu">fapply2</span><span class="op">(</span><span class="va">CNT</span>, <span class="va">PCT</span><span class="op">)</span></span>
<span>           </span>
<span>         <span class="op">}</span><span class="op">)</span> <span class="op">-&gt;</span> <span class="va">sex_comb</span> </span>
<span></span>
<span><span class="fu">put</span><span class="op">(</span><span class="st">"Transpose ARMs into columns"</span><span class="op">)</span></span>
<span><span class="fu">proc_transpose</span><span class="op">(</span><span class="va">sex_comb</span>, id <span class="op">=</span> <span class="va">BY</span>, </span>
<span>               var <span class="op">=</span> <span class="va">CNTPCT</span>,</span>
<span>               copy <span class="op">=</span> <span class="va">VAR</span>, by <span class="op">=</span> <span class="va">LABEL</span>,</span>
<span>               options <span class="op">=</span> <span class="va">noname</span><span class="op">)</span> <span class="op">-&gt;</span> <span class="va">sex_trans</span></span>
<span></span>
<span><span class="fu">put</span><span class="op">(</span><span class="st">"Apply formats"</span><span class="op">)</span></span>
<span><span class="fu">datastep</span><span class="op">(</span><span class="va">sex_trans</span>,</span>
<span>         <span class="op">{</span></span>
<span>           </span>
<span>           <span class="va">LABEL</span> <span class="op">&lt;-</span> <span class="fu">fapply</span><span class="op">(</span><span class="va">LABEL</span>, <span class="va">fmt_sex</span><span class="op">)</span></span>
<span>           </span>
<span>         <span class="op">}</span><span class="op">)</span> <span class="op">-&gt;</span> <span class="va">sex_cnts</span></span>
<span></span>
<span><span class="fu">put</span><span class="op">(</span><span class="st">"Sort by label"</span><span class="op">)</span></span>
<span><span class="fu">proc_sort</span><span class="op">(</span><span class="va">sex_cnts</span>, by <span class="op">=</span> <span class="va">LABEL</span><span class="op">)</span> <span class="op">-&gt;</span> <span class="va">sex_block</span> </span>
<span></span>
<span><span class="fu">put</span><span class="op">(</span><span class="st">"Append results"</span><span class="op">)</span></span>
<span><span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NULL.html" class="external-link">is.null</a></span><span class="op">(</span><span class="va">final</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">final</span> <span class="op">&lt;-</span> <span class="va">sex_block</span></span>
<span><span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span>  <span class="va">final</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span><span class="va">final</span>, <span class="va">sex_block</span><span class="op">)</span> </span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co">#%end</span></span>
<span></span>
<span><span class="co">#%if ("race" %in% vars.)</span></span>
<span></span>
<span><span class="co"># Race block --------------------------------------------------------------</span></span>
<span></span>
<span></span>
<span><span class="fu">sep</span><span class="op">(</span><span class="st">"Create frequency counts for RACE"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">put</span><span class="op">(</span><span class="st">"Race decodes"</span><span class="op">)</span></span>
<span><span class="va">fmt_race</span> <span class="op">&lt;-</span> <span class="fu">value</span><span class="op">(</span><span class="fu">condition</span><span class="op">(</span><span class="va">x</span> <span class="op">==</span> <span class="st">"WHITE"</span>, <span class="st">"White"</span><span class="op">)</span>,</span>
<span>                  <span class="fu">condition</span><span class="op">(</span><span class="va">x</span> <span class="op">==</span> <span class="st">"BLACK"</span>, <span class="st">"Black or African American"</span><span class="op">)</span>,</span>
<span>                  <span class="fu">condition</span><span class="op">(</span><span class="cn">TRUE</span>, <span class="st">"Other"</span><span class="op">)</span>,</span>
<span>                  as.factor <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">put</span><span class="op">(</span><span class="st">"Get race frequency counts"</span><span class="op">)</span></span>
<span><span class="fu">proc_freq</span><span class="op">(</span><span class="va">adsl_f</span>, tables <span class="op">=</span> <span class="va">RACE</span>,</span>
<span>          by <span class="op">=</span> <span class="va">ARM</span>,</span>
<span>          options <span class="op">=</span> <span class="va">nonobs</span><span class="op">)</span> <span class="op">-&gt;</span> <span class="va">race_freq</span> </span>
<span></span>
<span></span>
<span><span class="fu">put</span><span class="op">(</span><span class="st">"Combine counts and percents."</span><span class="op">)</span></span>
<span><span class="fu">datastep</span><span class="op">(</span><span class="va">race_freq</span>, </span>
<span>         format <span class="op">=</span> <span class="va">fc</span>, </span>
<span>         rename <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>CAT <span class="op">=</span> <span class="st">"LABEL"</span><span class="op">)</span>,</span>
<span>         drop <span class="op">=</span> <span class="fu"><a href="https://common.r-sassy.org/reference/v.html" class="external-link">v</a></span><span class="op">(</span><span class="va">CNT</span>, <span class="va">PCT</span><span class="op">)</span>, </span>
<span>         <span class="op">{</span></span>
<span>           </span>
<span>           <span class="va">CNTPCT</span> <span class="op">&lt;-</span> <span class="fu">fapply2</span><span class="op">(</span><span class="va">CNT</span>, <span class="va">PCT</span><span class="op">)</span></span>
<span>           </span>
<span>         <span class="op">}</span><span class="op">)</span> <span class="op">-&gt;</span> <span class="va">race_comb</span> </span>
<span></span>
<span><span class="fu">put</span><span class="op">(</span><span class="st">"Transpose ARMs into columns"</span><span class="op">)</span></span>
<span><span class="fu">proc_transpose</span><span class="op">(</span><span class="va">race_comb</span>, id <span class="op">=</span> <span class="va">BY</span>, var <span class="op">=</span> <span class="va">CNTPCT</span>,</span>
<span>               copy <span class="op">=</span> <span class="va">VAR</span>, by <span class="op">=</span> <span class="va">LABEL</span>, options <span class="op">=</span> <span class="va">noname</span><span class="op">)</span> <span class="op">-&gt;</span> <span class="va">race_trans</span></span>
<span></span>
<span><span class="fu">put</span><span class="op">(</span><span class="st">"Clean up"</span><span class="op">)</span></span>
<span><span class="fu">datastep</span><span class="op">(</span><span class="va">race_trans</span>, </span>
<span>         <span class="op">{</span></span>
<span>           <span class="va">VAR</span> <span class="op">&lt;-</span> <span class="st">"Race"</span></span>
<span>           <span class="va">LABEL</span> <span class="op">&lt;-</span> <span class="fu">fapply</span><span class="op">(</span><span class="va">LABEL</span>, <span class="va">fmt_race</span><span class="op">)</span></span>
<span>           </span>
<span>         <span class="op">}</span><span class="op">)</span> <span class="op">-&gt;</span> <span class="va">race_cnts</span> </span>
<span></span>
<span><span class="fu">put</span><span class="op">(</span><span class="st">"Sort by label"</span><span class="op">)</span></span>
<span><span class="fu">proc_sort</span><span class="op">(</span><span class="va">race_cnts</span>, by <span class="op">=</span> <span class="va">LABEL</span><span class="op">)</span> <span class="op">-&gt;</span> <span class="va">race_block</span> </span>
<span></span>
<span><span class="fu">put</span><span class="op">(</span><span class="st">"Append results"</span><span class="op">)</span></span>
<span><span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NULL.html" class="external-link">is.null</a></span><span class="op">(</span><span class="va">final</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">final</span> <span class="op">&lt;-</span> <span class="va">race_block</span></span>
<span><span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span>  <span class="va">final</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span><span class="va">final</span>, <span class="va">race_block</span><span class="op">)</span> </span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co">#%end</span></span>
<span></span>
<span><span class="co"># Report ------------------------------------------------------------------</span></span>
<span></span>
<span><span class="co">#% Include standard report code 01</span></span>
<span><span class="co">#%include 'template_path./rpt01.R'</span></span>
<span></span>
<span><span class="co"># Clean Up ----------------------------------------------------------------</span></span>
<span><span class="fu">sep</span><span class="op">(</span><span class="st">"Clean Up"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">put</span><span class="op">(</span><span class="st">"Close log"</span><span class="op">)</span></span>
<span><span class="fu">log_close</span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="co"># Uncomment to view report</span></span>
<span><span class="co"># file.show(res$modified_path)</span></span>
<span></span>
<span><span class="co"># Uncomment to view log</span></span>
<span><span class="co"># file.show(lf)</span></span></code></pre></div>
<p>In the above code, notice the following:</p>
<ul>
<li>The template program includes logging from the <strong>logr</strong>
package and formatting from the <strong>fmtr</strong> package.</li>
<li>Several macro variables are used from the macro driver. These macro
variables include the program name, treatment groups, sponsor name,
study name, etc.</li>
<li>Data for the program can either come from the “prod” or “dev”
environment. If the environment is “dev”, sample data is used. If the
environment is “prod”, a real dataset is used. The “dev” sample data
comes from an included code snippet.</li>
<li>The code for all four analysis variables is included in the program.
The code section for each analysis variable is surrounded by macro
conditions. These conditions will include or exclude that code from the
generated file.</li>
<li>Analysis variable blocks are created using functions from the
<strong>procs</strong> package.</li>
<li>The report code comes from an included template code snippet.</li>
</ul>
</div>
<div class="section level3">
<h3 id="template-code-snippets">Template Code Snippets<a class="anchor" aria-label="anchor" href="#template-code-snippets"></a>
</h3>
<p>Here is the template code for the sample dataset:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">adsl</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html" class="external-link">read.table</a></span><span class="op">(</span>header <span class="op">=</span> <span class="cn">TRUE</span>, text <span class="op">=</span> <span class="st">'</span></span>
<span><span class="st">  SUBJID  ARM    SEX  RACE    AGE</span></span>
<span><span class="st">  "001"   "ARM A" "F"  "WHITE" 19 </span></span>
<span><span class="st">  "002"   "ARM B" "F"  "WHITE" 21 </span></span>
<span><span class="st">  "003"   "ARM C" "F"  "WHITE" 23 </span></span>
<span><span class="st">  "004"   "ARM D" "F"  "BLACK" 28 </span></span>
<span><span class="st">  "005"   "ARM A" "M"  "WHITE" 37  </span></span>
<span><span class="st">  "006"   "ARM B" "M"  "WHITE" 34 </span></span>
<span><span class="st">  "007"   "ARM C" "M"  "WHITE" 36  </span></span>
<span><span class="st">  "008"   "ARM D" "M"  "WHITE" 30   </span></span>
<span><span class="st">  "009"   "ARM A" "F"  "WHITE" 39  </span></span>
<span><span class="st">  "010"   "ARM B" "F"  "WHITE" 31  </span></span>
<span><span class="st">  "011"   "ARM C" "F"  "BLACK" 33 </span></span>
<span><span class="st">  "012"   "ARM D" "F"  "WHITE" 38 </span></span>
<span><span class="st">  "013"   "ARM A" "M"  "BLACK" 37 </span></span>
<span><span class="st">  "014"   "ARM B" "M"  "WHITE" 34  </span></span>
<span><span class="st">  "015"   "ARM C" "M"  "WHITE" 36</span></span>
<span><span class="st">  "016"   "ARM A" "M"  "WHITE" 40'</span><span class="op">)</span></span></code></pre></div>
<p>Here is the template code for the report snippet:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span></span>
<span><span class="fu">sep</span><span class="op">(</span><span class="st">"Create and print report"</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#%if (%symexist(out_type) == FALSE)</span></span>
<span>  <span class="co">#%let out_type &lt;- "RTF"</span></span>
<span><span class="co">#%end</span></span>
<span></span>
<span><span class="co"># Create Table</span></span>
<span><span class="va">tbl</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://reporter.r-sassy.org/reference/create_table.html" class="external-link">create_table</a></span><span class="op">(</span><span class="va">final</span>, first_row_blank <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">|&gt;</span>  </span>
<span>  <span class="fu"><a href="https://reporter.r-sassy.org/reference/column_defaults.html" class="external-link">column_defaults</a></span><span class="op">(</span>from <span class="op">=</span> <span class="va">`ARM A`</span>, to <span class="op">=</span> <span class="va">`ARM D`</span>, align <span class="op">=</span> <span class="st">"center"</span>, width <span class="op">=</span> <span class="fl">1.1</span><span class="op">)</span> <span class="op">|&gt;</span>  </span>
<span>  <span class="fu"><a href="https://reporter.r-sassy.org/reference/stub.html" class="external-link">stub</a></span><span class="op">(</span>vars <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"VAR"</span>, <span class="st">"LABEL"</span><span class="op">)</span>, <span class="st">"Variable"</span>, width <span class="op">=</span> <span class="fl">2.5</span><span class="op">)</span> <span class="op">|&gt;</span>  </span>
<span>  <span class="fu"><a href="https://reporter.r-sassy.org/reference/define.html" class="external-link">define</a></span><span class="op">(</span><span class="va">VAR</span>, blank_after <span class="op">=</span> <span class="cn">TRUE</span>, dedupe <span class="op">=</span> <span class="cn">TRUE</span>, label <span class="op">=</span> <span class="st">"Variable"</span>,</span>
<span>         label_row <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">|&gt;</span>  </span>
<span>  <span class="fu"><a href="https://reporter.r-sassy.org/reference/define.html" class="external-link">define</a></span><span class="op">(</span><span class="va">LABEL</span>, indent <span class="op">=</span> <span class="fl">.25</span>, label <span class="op">=</span> <span class="st">"Demographic Category"</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://reporter.r-sassy.org/reference/titles.html" class="external-link">titles</a></span><span class="op">(</span><span class="va">titles.</span>, bold <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://reporter.r-sassy.org/reference/footnotes.html" class="external-link">footnotes</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"Program: "</span>, <span class="va">prog_nm</span>, <span class="st">".R"</span><span class="op">)</span>,</span>
<span>            <span class="st">"NOTE: Denominator based on number of non-missing responses."</span><span class="op">)</span> </span>
<span></span>
<span><span class="co"># Add treatment groups</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">trt</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">trt_grps</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">tbl</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://reporter.r-sassy.org/reference/define.html" class="external-link">define</a></span><span class="op">(</span><span class="va">tbl</span>, <span class="va">trt</span>, label <span class="op">=</span> <span class="va">trt_grps</span><span class="op">[</span><span class="va">trt</span><span class="op">]</span>, n <span class="op">=</span> <span class="va">arm_pop</span><span class="op">[</span><span class="va">trt</span><span class="op">]</span>, standard_eval <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># Create report</span></span>
<span><span class="va">rpt</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://reporter.r-sassy.org/reference/create_report.html" class="external-link">create_report</a></span><span class="op">(</span><span class="va">o_path</span>, </span>
<span>                     output_type <span class="op">=</span> <span class="st">"out_type."</span>, </span>
<span>                     font <span class="op">=</span> <span class="st">"Arial"</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://reporter.r-sassy.org/reference/page_header.html" class="external-link">page_header</a></span><span class="op">(</span><span class="st">"Sponsor: Company"</span>, <span class="st">"Study: ABC"</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://reporter.r-sassy.org/reference/set_margins.html" class="external-link">set_margins</a></span><span class="op">(</span>top <span class="op">=</span> <span class="fl">1</span>, bottom <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">|&gt;</span>  </span>
<span>  <span class="fu"><a href="https://reporter.r-sassy.org/reference/add_content.html" class="external-link">add_content</a></span><span class="op">(</span><span class="va">tbl</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://reporter.r-sassy.org/reference/page_footer.html" class="external-link">page_footer</a></span><span class="op">(</span><span class="st">"Date Produced: {toupper(fapply(Sys.Date(), '%Y%b%d'))}"</span>, </span>
<span>              right <span class="op">=</span> <span class="st">"Page [pg] of [tpg]"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">put</span><span class="op">(</span><span class="st">"Write out the report"</span><span class="op">)</span></span>
<span><span class="va">res</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://reporter.r-sassy.org/reference/write_report.html" class="external-link">write_report</a></span><span class="op">(</span><span class="va">rpt</span><span class="op">)</span></span></code></pre></div>
<p>In the above reporting code, notice the following:</p>
<ul>
<li>The code starts by setting a default output type of “RTF” if the
<code>out_type</code> variable does not exist. The condition uses the
<code>%symexist()</code> function to make that determination.</li>
<li>Definitions for the treatment group columns are created dynamically
from the <code>trt_grps</code> variable.</li>
<li>Titles, footnotes, etc. are populated from the macro driver.</li>
<li>The report functions come from the <strong>reporter</strong>
package.</li>
</ul>
</div>
<div class="section level3">
<h3 id="generated-code">Generated Code<a class="anchor" aria-label="anchor" href="#generated-code"></a>
</h3>
<p>Upon execution of the call to <code><a href="../reference/msource.html">msource()</a></code>, the following
code will be generated:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="co">#####################################################################</span></span>
<span><span class="co"># Program Name: t_dm</span></span>
<span><span class="co"># Study: ABC</span></span>
<span><span class="co">#####################################################################</span></span>
<span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://r-sassy.org" class="external-link">sassy</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Prepare Log -------------------------------------------------------------</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/options.html" class="external-link">options</a></span><span class="op">(</span><span class="st">"logr.autolog"</span> <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>        <span class="st">"logr.on"</span> <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>        <span class="st">"logr.notes"</span> <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>        <span class="st">"procs.print"</span> <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Assign program name</span></span>
<span><span class="va">prog_nm</span> <span class="op">&lt;-</span> <span class="st">"t_dm"</span></span>
<span></span>
<span><span class="co"># Construct paths</span></span>
<span><span class="va">l_path</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="st">"c:/packages/Testing/macro/code/log"</span>, <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">prog_nm</span>, <span class="st">".log"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">o_path</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="st">"c:/packages/Testing/macro/code/output"</span>, <span class="va">prog_nm</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Open log</span></span>
<span><span class="va">lf</span> <span class="op">&lt;-</span> <span class="fu">log_open</span><span class="op">(</span><span class="va">l_path</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Prepare formats ---------------------------------------------------------</span></span>
<span></span>
<span><span class="fu">sep</span><span class="op">(</span><span class="st">"Prepare formats"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">put</span><span class="op">(</span><span class="st">"Compile format catalog"</span><span class="op">)</span></span>
<span><span class="va">fc</span> <span class="op">&lt;-</span> <span class="fu">fcat</span><span class="op">(</span>MEAN <span class="op">=</span> <span class="st">"%.1f"</span>, STD <span class="op">=</span> <span class="st">"(%.2f)"</span>, </span>
<span>           Q1 <span class="op">=</span> <span class="st">"%.1f"</span>, Q3 <span class="op">=</span> <span class="st">"%.1f"</span>,</span>
<span>           MIN <span class="op">=</span> <span class="st">"%d"</span>, MAX <span class="op">=</span> <span class="st">"%d"</span>, </span>
<span>           CNT <span class="op">=</span> <span class="st">"%2d"</span>, PCT <span class="op">=</span> <span class="st">"(%5.1f%%)"</span><span class="op">)</span> </span>
<span></span>
<span><span class="co"># Load and Prepare Data ---------------------------------------------------</span></span>
<span></span>
<span><span class="fu">sep</span><span class="op">(</span><span class="st">"Prepare Data"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">put</span><span class="op">(</span><span class="st">"Create sample ADSL data."</span><span class="op">)</span></span>
<span><span class="va">adsl</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html" class="external-link">read.table</a></span><span class="op">(</span>header <span class="op">=</span> <span class="cn">TRUE</span>, text <span class="op">=</span> <span class="st">'</span></span>
<span><span class="st">  SUBJID  ARM    SEX  RACE    AGE</span></span>
<span><span class="st">  "001"   "ARM A" "F"  "WHITE" 19 </span></span>
<span><span class="st">  "002"   "ARM B" "F"  "WHITE" 21 </span></span>
<span><span class="st">  "003"   "ARM C" "F"  "WHITE" 23 </span></span>
<span><span class="st">  "004"   "ARM D" "F"  "BLACK" 28 </span></span>
<span><span class="st">  "005"   "ARM A" "M"  "WHITE" 37  </span></span>
<span><span class="st">  "006"   "ARM B" "M"  "WHITE" 34 </span></span>
<span><span class="st">  "007"   "ARM C" "M"  "WHITE" 36  </span></span>
<span><span class="st">  "008"   "ARM D" "M"  "WHITE" 30   </span></span>
<span><span class="st">  "009"   "ARM A" "F"  "WHITE" 39  </span></span>
<span><span class="st">  "010"   "ARM B" "F"  "WHITE" 31  </span></span>
<span><span class="st">  "011"   "ARM C" "F"  "BLACK" 33 </span></span>
<span><span class="st">  "012"   "ARM D" "F"  "WHITE" 38 </span></span>
<span><span class="st">  "013"   "ARM A" "M"  "BLACK" 37 </span></span>
<span><span class="st">  "014"   "ARM B" "M"  "WHITE" 34  </span></span>
<span><span class="st">  "015"   "ARM C" "M"  "WHITE" 36</span></span>
<span><span class="st">  "016"   "ARM A" "M"  "WHITE" 40'</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">put</span><span class="op">(</span><span class="st">"Log starting dataset"</span><span class="op">)</span></span>
<span><span class="fu">put</span><span class="op">(</span><span class="va">adsl</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">put</span><span class="op">(</span><span class="st">"Filter out screen failure"</span><span class="op">)</span></span>
<span><span class="va">adsl_f</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="va">adsl</span>, <span class="va">ARM</span> <span class="op">!=</span> <span class="st">'SCREEN FAILURE'</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">put</span><span class="op">(</span><span class="st">"Get ARM population counts"</span><span class="op">)</span></span>
<span><span class="fu">proc_freq</span><span class="op">(</span><span class="va">adsl_f</span>, tables <span class="op">=</span> <span class="va">ARM</span>, </span>
<span>          output <span class="op">=</span> <span class="va">long</span>,</span>
<span>          options <span class="op">=</span> <span class="fu"><a href="https://common.r-sassy.org/reference/v.html" class="external-link">v</a></span><span class="op">(</span><span class="va">nopercent</span>, <span class="va">nonobs</span><span class="op">)</span><span class="op">)</span> <span class="op">-&gt;</span> <span class="va">arm_pop</span></span>
<span></span>
<span><span class="fu">put</span><span class="op">(</span><span class="st">"Log treatment groups variable"</span><span class="op">)</span></span>
<span><span class="va">trt_grps</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'ARM A'</span> <span class="op">=</span> <span class="st">'Placebo'</span>, <span class="st">'ARM B'</span> <span class="op">=</span> <span class="st">'Drug 50mg'</span>, </span>
<span>              <span class="st">'ARM C'</span> <span class="op">=</span> <span class="st">'Drug 100mg'</span>, <span class="st">'ARM D'</span> <span class="op">=</span> <span class="st">'Competitor'</span><span class="op">)</span></span>
<span><span class="fu">put</span><span class="op">(</span><span class="va">trt_grps</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Initialize block variables ----------------------------------------------</span></span>
<span></span>
<span><span class="co"># Initialize final dataset</span></span>
<span><span class="va">final</span> <span class="op">&lt;-</span> <span class="cn">NULL</span></span>
<span></span>
<span><span class="co"># Age Summary Block -------------------------------------------------------</span></span>
<span></span>
<span><span class="fu">sep</span><span class="op">(</span><span class="st">"Create summary statistics for age"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">put</span><span class="op">(</span><span class="st">"Call means procedure to get summary statistics for age"</span><span class="op">)</span></span>
<span><span class="fu">proc_means</span><span class="op">(</span><span class="va">adsl_f</span>, var <span class="op">=</span> <span class="va">AGE</span>,</span>
<span>           stats <span class="op">=</span> <span class="fu"><a href="https://common.r-sassy.org/reference/v.html" class="external-link">v</a></span><span class="op">(</span><span class="va">n</span>, <span class="va">mean</span>, <span class="va">std</span>, <span class="va">median</span>, <span class="va">q1</span>, <span class="va">q3</span>, <span class="va">min</span>, <span class="va">max</span><span class="op">)</span>,</span>
<span>           by <span class="op">=</span> <span class="va">ARM</span>, </span>
<span>           options <span class="op">=</span> <span class="fu"><a href="https://common.r-sassy.org/reference/v.html" class="external-link">v</a></span><span class="op">(</span><span class="va">notype</span>, <span class="va">nofreq</span><span class="op">)</span><span class="op">)</span> <span class="op">-&gt;</span> <span class="va">age_stats</span> </span>
<span></span>
<span><span class="fu">put</span><span class="op">(</span><span class="st">"Combine stats"</span><span class="op">)</span></span>
<span><span class="fu">datastep</span><span class="op">(</span><span class="va">age_stats</span>, </span>
<span>         format <span class="op">=</span> <span class="va">fc</span>,</span>
<span>         drop <span class="op">=</span> <span class="fu"><a href="https://common.r-sassy.org/reference/find.names.html" class="external-link">find.names</a></span><span class="op">(</span><span class="va">age_stats</span>, start <span class="op">=</span> <span class="fl">4</span><span class="op">)</span>, </span>
<span>         <span class="op">{</span></span>
<span>           <span class="va">VAR</span> <span class="op">&lt;-</span> <span class="st">"Age"</span></span>
<span>           <span class="va">`Mean (SD)`</span> <span class="op">&lt;-</span> <span class="fu">fapply2</span><span class="op">(</span><span class="va">MEAN</span>, <span class="va">STD</span><span class="op">)</span></span>
<span>           <span class="va">Median</span> <span class="op">&lt;-</span> <span class="va">MEDIAN</span></span>
<span>           <span class="va">`Q1 - Q3`</span> <span class="op">&lt;-</span> <span class="fu">fapply2</span><span class="op">(</span><span class="va">Q1</span>, <span class="va">Q3</span>, sep <span class="op">=</span> <span class="st">" - "</span><span class="op">)</span></span>
<span>           <span class="va">`Min - Max`</span> <span class="op">&lt;-</span> <span class="fu">fapply2</span><span class="op">(</span><span class="va">MIN</span>, <span class="va">MAX</span>, sep <span class="op">=</span> <span class="st">" - "</span><span class="op">)</span></span>
<span>           </span>
<span>         <span class="op">}</span><span class="op">)</span> <span class="op">-&gt;</span> <span class="va">age_comb</span></span>
<span></span>
<span><span class="fu">put</span><span class="op">(</span><span class="st">"Transpose ARMs into columns"</span><span class="op">)</span></span>
<span><span class="fu">proc_transpose</span><span class="op">(</span><span class="va">age_comb</span>, </span>
<span>               var <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">age_comb</span><span class="op">)</span>,</span>
<span>               copy <span class="op">=</span> <span class="va">VAR</span>, id <span class="op">=</span> <span class="va">BY</span>, </span>
<span>               name <span class="op">=</span> <span class="va">LABEL</span><span class="op">)</span> <span class="op">-&gt;</span> <span class="va">age_block</span> </span>
<span></span>
<span><span class="fu">put</span><span class="op">(</span><span class="st">"Append results"</span><span class="op">)</span></span>
<span><span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NULL.html" class="external-link">is.null</a></span><span class="op">(</span><span class="va">final</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">final</span> <span class="op">&lt;-</span> <span class="va">age_block</span></span>
<span><span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span>  <span class="va">final</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span><span class="va">final</span>, <span class="va">age_block</span><span class="op">)</span> </span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># Age Group Block ----------------------------------------------------------</span></span>
<span></span>
<span><span class="fu">sep</span><span class="op">(</span><span class="st">"Create frequency counts for Age Group"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">put</span><span class="op">(</span><span class="st">"Age categories"</span><span class="op">)</span></span>
<span><span class="va">agecat</span> <span class="op">&lt;-</span> <span class="fu">value</span><span class="op">(</span><span class="fu">condition</span><span class="op">(</span><span class="va">x</span> <span class="op">&gt;=</span> <span class="fl">18</span> <span class="op">&amp;</span> <span class="va">x</span> <span class="op">&lt;=</span> <span class="fl">29</span>, <span class="st">"18 to 29"</span><span class="op">)</span>,</span>
<span>                <span class="fu">condition</span><span class="op">(</span><span class="va">x</span> <span class="op">&gt;=</span><span class="fl">30</span> <span class="op">&amp;</span> <span class="va">x</span> <span class="op">&lt;=</span> <span class="fl">39</span>, <span class="st">"30 to 39"</span><span class="op">)</span>,</span>
<span>                <span class="fu">condition</span><span class="op">(</span><span class="va">x</span> <span class="op">&gt;=</span><span class="fl">40</span> <span class="op">&amp;</span> <span class="va">x</span> <span class="op">&lt;=</span><span class="fl">49</span>, <span class="st">"40 to 49"</span><span class="op">)</span>,</span>
<span>                <span class="fu">condition</span><span class="op">(</span><span class="va">x</span> <span class="op">&gt;=</span> <span class="fl">50</span>, <span class="st">"&gt;= 50"</span><span class="op">)</span>,</span>
<span>                as.factor <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> </span>
<span></span>
<span><span class="fu">put</span><span class="op">(</span><span class="st">"Categorize AGE"</span><span class="op">)</span></span>
<span><span class="va">adsl_f</span><span class="op">$</span><span class="va">AGECAT</span> <span class="op">&lt;-</span> <span class="fu">fapply</span><span class="op">(</span><span class="va">adsl_f</span><span class="op">$</span><span class="va">AGE</span>, <span class="va">agecat</span><span class="op">)</span> </span>
<span></span>
<span><span class="fu">put</span><span class="op">(</span><span class="st">"Get age group frequency counts"</span><span class="op">)</span></span>
<span><span class="fu">proc_freq</span><span class="op">(</span><span class="va">adsl_f</span>,</span>
<span>          table <span class="op">=</span> <span class="va">AGECAT</span>,</span>
<span>          by <span class="op">=</span> <span class="va">ARM</span>,</span>
<span>          options <span class="op">=</span> <span class="va">nonobs</span><span class="op">)</span> <span class="op">-&gt;</span> <span class="va">ageg_freq</span></span>
<span></span>
<span><span class="fu">put</span><span class="op">(</span><span class="st">"Combine counts and percents and assign age group factor for sorting"</span><span class="op">)</span></span>
<span><span class="fu">datastep</span><span class="op">(</span><span class="va">ageg_freq</span>,</span>
<span>         format <span class="op">=</span> <span class="va">fc</span>, </span>
<span>         keep <span class="op">=</span> <span class="fu"><a href="https://common.r-sassy.org/reference/v.html" class="external-link">v</a></span><span class="op">(</span><span class="va">VAR</span>, <span class="va">LABEL</span>, <span class="va">BY</span>, <span class="va">CNTPCT</span><span class="op">)</span>,</span>
<span>         <span class="op">{</span></span>
<span>           <span class="va">VAR</span> <span class="op">&lt;-</span> <span class="st">"Age Group"</span></span>
<span>           <span class="va">CNTPCT</span> <span class="op">&lt;-</span> <span class="fu">fapply2</span><span class="op">(</span><span class="va">CNT</span>, <span class="va">PCT</span><span class="op">)</span></span>
<span>           <span class="va">LABEL</span> <span class="op">&lt;-</span> <span class="va">CAT</span></span>
<span>         <span class="op">}</span><span class="op">)</span> <span class="op">-&gt;</span> <span class="va">ageg_comb</span></span>
<span></span>
<span><span class="fu">put</span><span class="op">(</span><span class="st">"Sort by age group factor"</span><span class="op">)</span></span>
<span><span class="fu">proc_sort</span><span class="op">(</span><span class="va">ageg_comb</span>, by <span class="op">=</span> <span class="fu"><a href="https://common.r-sassy.org/reference/v.html" class="external-link">v</a></span><span class="op">(</span><span class="va">BY</span>, <span class="va">LABEL</span><span class="op">)</span><span class="op">)</span> <span class="op">-&gt;</span> <span class="va">ageg_sort</span> </span>
<span></span>
<span><span class="fu">put</span><span class="op">(</span><span class="st">"Tranpose age group block"</span><span class="op">)</span></span>
<span><span class="fu">proc_transpose</span><span class="op">(</span><span class="va">ageg_sort</span>,</span>
<span>               var <span class="op">=</span> <span class="va">CNTPCT</span>,</span>
<span>               copy <span class="op">=</span> <span class="va">VAR</span>,</span>
<span>               id <span class="op">=</span> <span class="va">BY</span>,</span>
<span>               by <span class="op">=</span> <span class="va">LABEL</span>, </span>
<span>               options <span class="op">=</span> <span class="va">noname</span><span class="op">)</span> <span class="op">-&gt;</span> <span class="va">ageg_block</span> </span>
<span></span>
<span><span class="fu">put</span><span class="op">(</span><span class="st">"Append results"</span><span class="op">)</span></span>
<span><span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NULL.html" class="external-link">is.null</a></span><span class="op">(</span><span class="va">final</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">final</span> <span class="op">&lt;-</span> <span class="va">ageg_block</span></span>
<span><span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span>  <span class="va">final</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span><span class="va">final</span>, <span class="va">ageg_block</span><span class="op">)</span> </span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># Report ------------------------------------------------------------------</span></span>
<span></span>
<span><span class="fu">sep</span><span class="op">(</span><span class="st">"Create and print report"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Create Table</span></span>
<span><span class="va">tbl</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://reporter.r-sassy.org/reference/create_table.html" class="external-link">create_table</a></span><span class="op">(</span><span class="va">final</span>, first_row_blank <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">|&gt;</span>  </span>
<span>  <span class="fu"><a href="https://reporter.r-sassy.org/reference/column_defaults.html" class="external-link">column_defaults</a></span><span class="op">(</span>from <span class="op">=</span> <span class="va">`ARM A`</span>, to <span class="op">=</span> <span class="va">`ARM D`</span>, align <span class="op">=</span> <span class="st">"center"</span>, width <span class="op">=</span> <span class="fl">1.1</span><span class="op">)</span> <span class="op">|&gt;</span>  </span>
<span>  <span class="fu"><a href="https://reporter.r-sassy.org/reference/stub.html" class="external-link">stub</a></span><span class="op">(</span>vars <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"VAR"</span>, <span class="st">"LABEL"</span><span class="op">)</span>, <span class="st">"Variable"</span>, width <span class="op">=</span> <span class="fl">2.5</span><span class="op">)</span> <span class="op">|&gt;</span>  </span>
<span>  <span class="fu"><a href="https://reporter.r-sassy.org/reference/define.html" class="external-link">define</a></span><span class="op">(</span><span class="va">VAR</span>, blank_after <span class="op">=</span> <span class="cn">TRUE</span>, dedupe <span class="op">=</span> <span class="cn">TRUE</span>, label <span class="op">=</span> <span class="st">"Variable"</span>,</span>
<span>         label_row <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">|&gt;</span>  </span>
<span>  <span class="fu"><a href="https://reporter.r-sassy.org/reference/define.html" class="external-link">define</a></span><span class="op">(</span><span class="va">LABEL</span>, indent <span class="op">=</span> <span class="fl">.25</span>, label <span class="op">=</span> <span class="st">"Demographic Category"</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://reporter.r-sassy.org/reference/titles.html" class="external-link">titles</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'Table 1.0'</span>, <span class="st">'Analysis of Demographic Characteristics'</span>, </span>
<span>           <span class="st">'Safety Population'</span><span class="op">)</span>, bold <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://reporter.r-sassy.org/reference/footnotes.html" class="external-link">footnotes</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'Program: t_dm.R'</span>, </span>
<span>              <span class="st">'NOTE: Denominator based on number of non-missing responses.'</span><span class="op">)</span><span class="op">)</span> </span>
<span></span>
<span><span class="co"># Add treatment groups</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">trt</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">trt_grps</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">tbl</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://reporter.r-sassy.org/reference/define.html" class="external-link">define</a></span><span class="op">(</span><span class="va">tbl</span>, <span class="va">trt</span>, label <span class="op">=</span> <span class="va">trt_grps</span><span class="op">[</span><span class="va">trt</span><span class="op">]</span>, n <span class="op">=</span> <span class="va">arm_pop</span><span class="op">[</span><span class="va">trt</span><span class="op">]</span>, </span>
<span>                standard_eval <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># Create report</span></span>
<span><span class="va">rpt</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://reporter.r-sassy.org/reference/create_report.html" class="external-link">create_report</a></span><span class="op">(</span><span class="va">o_path</span>, </span>
<span>                     output_type <span class="op">=</span> <span class="st">"PDF"</span>, </span>
<span>                     font <span class="op">=</span> <span class="st">"Arial"</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://reporter.r-sassy.org/reference/page_header.html" class="external-link">page_header</a></span><span class="op">(</span><span class="st">"Sponsor: Acme, Inc."</span>, <span class="st">"Study: ABC"</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://reporter.r-sassy.org/reference/set_margins.html" class="external-link">set_margins</a></span><span class="op">(</span>top <span class="op">=</span> <span class="fl">1</span>, bottom <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">|&gt;</span>  </span>
<span>  <span class="fu"><a href="https://reporter.r-sassy.org/reference/add_content.html" class="external-link">add_content</a></span><span class="op">(</span><span class="va">tbl</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://reporter.r-sassy.org/reference/page_footer.html" class="external-link">page_footer</a></span><span class="op">(</span><span class="st">"Date Produced: {toupper(fapply(Sys.Date(), '%Y%b%d'))}"</span>, </span>
<span>              right <span class="op">=</span> <span class="st">"Page [pg] of [tpg]"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">put</span><span class="op">(</span><span class="st">"Write out the report"</span><span class="op">)</span></span>
<span><span class="va">res</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://reporter.r-sassy.org/reference/write_report.html" class="external-link">write_report</a></span><span class="op">(</span><span class="va">rpt</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Clean Up ----------------------------------------------------------------</span></span>
<span><span class="fu">sep</span><span class="op">(</span><span class="st">"Clean Up"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">put</span><span class="op">(</span><span class="st">"Close log"</span><span class="op">)</span></span>
<span><span class="fu">log_close</span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Uncomment to view report</span></span>
<span><span class="co"># file.show(res$modified_path)</span></span>
<span></span>
<span><span class="co"># Uncomment to view log</span></span>
<span><span class="co"># file.show(lf)</span></span></code></pre></div>
<p>Observe that the generated code is clean and easy to read. Only the
necessary lines from the template program are emitted during
pre-processing.</p>
</div>
<div class="section level3">
<h3 id="result">Result<a class="anchor" aria-label="anchor" href="#result"></a>
</h3>
<p>Here is the output report:
<img src="../man/images/example3.png"></p>
<p>To add more analysis variables, just change the “trt_groups.” macro
variable in the driver program. You can also change the titles,
footnotes, and other parameters as desired. The generated code will
adjust dynamically to all parameter settings.</p>
<p>Next: <a href="macro-disclaimer.html">Disclaimer</a></p>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

      </div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by David Bosak.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.0.</p>
</div>

      </footer>
</div>






  </body>
</html>
